
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title> Dragging - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../TracGuide.html"/><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/diff.css" type="text/css"/><link rel="icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="prev" href="Dragging%3Faction=diff&amp;version=11.html" title="Version 11"/><link rel="next" href="Dragging%3Faction=diff&amp;version=13.html" title="Version 13"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../documentation.html"><img id="title" src="../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/>
<a href="../../documentation.html"><img id="rocket" src="../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/tutorials/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="../tutorials.1.html">tutorials</a> <strong>&#8249;</strong> <a href="Dragging.html">Dragging</a></div>
<div id="title"> Dragging</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<h1>Changes between
<a href="Dragging%3Fversion=11.html">Version 11</a> and
<a href="Dragging%3Fversion=12.html">Version 12</a> of
<a href="Dragging.html">documentation/tutorials/Dragging</a></h1>
<form method="post" id="prefs" action="Dragging.html"><div><input type="hidden" name="__FORM_TOKEN" value="a669ff33c84a83d396ad829a"/></div>
<div>
<input type="hidden" name="action" value="diff"/>
<input type="hidden" name="version" value="12"/>
<input type="hidden" name="old_version" value="11"/>
<label>View differences <select name="style">
<option value="inline" selected="selected">inline</option>
<option value="sidebyside">side by side</option>
</select></label>
<div class="field">
Show <input type="text" name="contextlines" id="contextlines" size="2" maxlength="3" value="2"/>
<label for="contextlines">lines around each change</label>
</div>
<fieldset id="ignore">
<legend>Ignore:</legend>
<div class="field">
<input type="checkbox" id="blanklines" name="ignoreblanklines"/>
<label for="blanklines">Blank lines</label>
</div>
<div class="field">
<input type="checkbox" id="case" name="ignorecase"/>
<label for="case">Case changes</label>
</div>
<div class="field">
<input type="checkbox" id="whitespace" name="ignorewhitespace"/>
<label for="whitespace">White space changes</label>
</div>
</fieldset>
<div class="buttons">
<input type="submit" name="update" value="Update"/>
</div>
</div>
</form>
<dl id="overview">
<dt class="property author">Author:</dt>
<dd class="author">peterc <span class="ipnr">(IP: 203.96.63.172)</span></dd>
<dt class="property time">Timestamp:</dt>
<dd class="time">03/13/08 12:31:42 (9 years ago)</dd>
<dt class="property message">Comment:</dt>
<dd class="message"><p>
--
</p>
</dd>
</dl>
<div class="diff">
<div id="legend">
<h3>Legend:</h3>
<dl>
<dt class="unmod"></dt><dd>Unmodified</dd>
<dt class="add"></dt><dd>Added</dd>
<dt class="rem"></dt><dd>Removed</dd>
<dt class="mod"></dt><dd>Modified</dd>
</dl>
</div>
<ul class="entries">
<li class="entry">
<h2>documentation/tutorials/Dragging</h2>
<table class="inline" summary="Differences">
<colgroup><col class="lineno"/><col class="lineno"/><col class="content"/></colgroup>
<thead><tr>
<th title="Version 11">v11</th>
<th title="Version 12">v12</th>
<th>&nbsp;</th>
</tr></thead><tbody><tr><th>91</th><th>91</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; if (event == "dragdrop")</span>&nbsp;</td></tr><tr><th>92</th><th>92</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; {</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>93</th><th>&nbsp;</th><td class="l">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rocket::Core::Element* <del></del>container = event.GetCurrentElement();&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>93</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rocket::Core::Element* <ins>dest_</ins>container = event.GetCurrentElement();&nbsp;</td></tr></tbody><tbody><tr><th>94</th><th>94</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rocket::Core::Element* drag_element = static_cast&lt; Rocket::Core::Element* &gt;(event.GetParameter&lt; void* &gt;("drag_element", NULL));</span>&nbsp;</td></tr><tr><th>95</th><th>95</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>96</th><th>96</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; drag_element-&gt;GetParentNode()-&gt;RemoveChild(drag_element);</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>97</th><th>&nbsp;</th><td class="l">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <del></del>container-&gt;AppendChild(drag_element);&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>97</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <ins>dest_</ins>container-&gt;AppendChild(drag_element);&nbsp;</td></tr></tbody><tbody><tr><th>98</th><th>98</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; }</span>&nbsp;</td></tr><tr><th>99</th><th>99</th><td class="l"><span>}</span>&nbsp;</td></tr><tr><th>100</th><th>100</th><td class="l"><span>}}}</span>&nbsp;</td></tr></tbody><tbody class="rem"><tr class="first"><th>101</th><th>&nbsp;</th><td class="l"><del></del>&nbsp;</td></tr><tr class="last"><th>102</th><th>&nbsp;</th><td class="l"><del>The container that received the drop is determined by ''event.GetCurrentElement()''. Events have both a target and a current element. The ''target element'' is the element the event was actually targetted at. The ''current element'' is the element the processing listener is observing; in our case, the container.</del>&nbsp;</td></tr></tbody><tbody><tr><th>103</th><th>101</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>104</th><th>102</th><td class="l"><span>The dragged element is simply removed from its old parent and attached to the container it was dropped onto.</span>&nbsp;</td></tr></tbody><tbody><tr><th>115</th><th>113</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>116</th><th>114</th><td class="l"><span>[[Image(tutorial_drag_2.jpg, nolink)]]</span>&nbsp;</td></tr></tbody><tbody class="add"><tr class="first"><th>&nbsp;</th><th>115</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>116</th><td class="r"><ins>Success!</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>117</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>118</th><td class="r"><ins>== Step 4: Sorting ==</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>119</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>120</th><td class="r"><ins>Currently, regardless of where you drag an item to it will end up as the last item in the window. It would be great if you could sort the items within a window by dragging them on top of each other. To do this, the ProcessEvent() function will need to determine both the container and the item within that container an element was dragged onto.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>121</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>122</th><td class="r"><ins>Easy! We've attached as a 'dragdrop' listener to the item containers. This means we'll be notified whenever the 'dragdrop' event is sent to the containers or any of their children (i.e., their items). Each event has a ''target'' element and a ''current'' element. The target element is the element the event was actually targetted at; in the case of 'dragdrop', the element that was dropped on. The current element is the element the processing listener is observing; in our case, the container.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>123</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>124</th><td class="r"><ins>So we can find the destination item and container with the following:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>125</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>126</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>127</th><td class="r"><ins>void DragListener::ProcessEvent(Rocket::Core::Event&amp; event)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>128</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>129</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (event == "dragdrop")</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>130</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>131</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rocket::Core::Element* dest_container = event.GetCurrentElement();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>132</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rocket::Core::Element* dest_element = event.GetTargetElement();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>133</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rocket::Core::Element* drag_element = static_cast&lt; Rocket::Core::Element* &gt;(event.GetParameter&lt; void* &gt;("drag_element", NULL));</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>134</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>135</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>136</th><td class="r"><ins>If the dragged item is dropped directly onto a container, then the current and target elements will be the same. In this case, we want to keep the old processing:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>137</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>138</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>139</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (dest_container == dest_element)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>140</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>141</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // The dragged element was dragged directly onto a container.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>142</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; drag_element-&gt;GetParentNode()-&gt;RemoveChild(drag_element);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>143</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dest_container-&gt;AppendChild(drag_element);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>144</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>145</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>146</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>147</th><td class="r"><ins>Otherwise, we want to insert the item into its new container ''before'' the item it was dragged onto.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>148</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>149</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>150</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>151</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>152</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // The dragged element was dragged onto an item inside a container. In order to get the</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>153</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // element in the right place, it will be inserted into the container before the item</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>154</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // it was dragged on top of.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>155</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Rocket::Core::Element* insert_before = dest_element;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>156</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>157</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; drag_element-&gt;GetParentNode()-&gt;RemoveChild(drag_element);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>158</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dest_container-&gt;InsertBefore(drag_element, insert_before);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>159</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>160</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>161</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>162</th><td class="r"><ins>Run the app again and try it out. All good, except try dragging an item onto another item within the same window; in this case, it should be inserted ''after'' the element it is dragged onto, not before. So, just fix that up in the event handler and you're done!</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>163</th><td class="r"><ins></ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>164</th><td class="r"><ins>You can find the fully-completed source in the drag sample.</ins>&nbsp;</td></tr></tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/tutorials/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
</div> 
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
