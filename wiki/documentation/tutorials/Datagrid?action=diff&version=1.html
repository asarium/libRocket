
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title> Datagrid - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../TracGuide.html"/><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/diff.css" type="text/css"/><link rel="icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="next" href="Datagrid%3Faction=diff&amp;version=2.html" title="Version 2"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../documentation.html"><img id="title" src="../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/>
<a href="../../documentation.html"><img id="rocket" src="../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/tutorials/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="../tutorials.1.html">tutorials</a> <strong>&#8249;</strong> <a href="Datagrid.html">Datagrid</a></div>
<div id="title"> Datagrid</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<h1>Changes from
<a href="Datagrid%3Fversion=1.html">Version 1</a> of
<a href="Datagrid.html">documentation/tutorials/Datagrid</a></h1>
<form method="post" id="prefs" action="Datagrid.html"><div><input type="hidden" name="__FORM_TOKEN" value="a669ff33c84a83d396ad829a"/></div>
<div>
<input type="hidden" name="action" value="diff"/>
<input type="hidden" name="version" value="1"/>
<input type="hidden" name="old_version" value/>
<label>View differences <select name="style">
<option value="inline" selected="selected">inline</option>
<option value="sidebyside">side by side</option>
</select></label>
<div class="field">
Show <input type="text" name="contextlines" id="contextlines" size="2" maxlength="3" value="2"/>
<label for="contextlines">lines around each change</label>
</div>
<fieldset id="ignore">
<legend>Ignore:</legend>
<div class="field">
<input type="checkbox" id="blanklines" name="ignoreblanklines"/>
<label for="blanklines">Blank lines</label>
</div>
<div class="field">
<input type="checkbox" id="case" name="ignorecase"/>
<label for="case">Case changes</label>
</div>
<div class="field">
<input type="checkbox" id="whitespace" name="ignorewhitespace"/>
<label for="whitespace">White space changes</label>
</div>
</fieldset>
<div class="buttons">
<input type="submit" name="update" value="Update"/>
</div>
 </div>
</form>
<dl id="overview">
<dt class="property author">Author:</dt>
<dd class="author">lloydw <span class="ipnr">(IP: 192.168.0.1)</span></dd>
<dt class="property time">Timestamp:</dt>
<dd class="time">01/04/08 13:57:07 (10 years ago)</dd>
<dt class="property message">Comment:</dt>
<dd class="message"><p>
--
</p>
</dd>
</dl>
<div class="diff">
<div id="legend">
<h3>Legend:</h3>
<dl>
<dt class="unmod"></dt><dd>Unmodified</dd>
<dt class="add"></dt><dd>Added</dd>
<dt class="rem"></dt><dd>Removed</dd>
<dt class="mod"></dt><dd>Modified</dd>
</dl>
</div>
<ul class="entries">
<li class="entry">
<h2>documentation/tutorials/Datagrid</h2>
<table class="inline" summary="Differences">
<colgroup><col class="lineno"/><col class="lineno"/><col class="content"/></colgroup>
<thead><tr>
<th title="Version ">v0</th>
<th title="Version 1">v1</th>
<th>&nbsp;</th>
</tr></thead><tbody class="add"><tr class="first"><th>&nbsp;</th><th>1</th><td class="r"><ins>[[PageOutline(1-5, Contents)]]</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>2</th><td class="r"><ins>= Datagrid Tutorial =</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>3</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>4</th><td class="r"><ins>This tutorial will take you through the process of upgrading an existing body of data to be a data source, then creating a datagrid to read from that source.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>5</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>6</th><td class="r"><ins>This tutorial expects that you've got a solid grounding in C++ and know the basics of RML and RCSS.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>7</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>8</th><td class="r"><ins>For a detailed description on how DataGrids work with DataSources please see the [wiki:documentation/C++Manual/Controls/DataGrid C++ Manual].</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>9</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>10</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>11</th><td class="r"><ins>== Step 1: Getting started ==</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>12</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>13</th><td class="r"><ins>Load up the Datagrid tutorial, compile and run it, you'll see a blank high scores window:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>14</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>15</th><td class="r"><ins>[[Image(tutorial_datagrid_1.gif, nolink)]]</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>16</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>17</th><td class="r"><ins>If you take a look at the C++ code, you see that there's a HighScores class that loads and stores a set of high scores. At the moment it doesn't do much at all - the next step will be to turn this into data source so it can talk with the datagrid that we're going to add later.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>18</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>19</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>20</th><td class="r"><ins>== Step 2: The data source ==</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>21</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>22</th><td class="r"><ins>EMP::Core::DataSource is an abstract base class which simulates the interface to a database. Each data source contains one or more tables, and each table contains rows and columns. The columns specify the fields each row has. To inherit from EMP::Core::DataSource, you need to override two functions:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>23</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>24</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>25</th><td class="r"><ins>virtual void GetRow(EMP::Core::StringList&amp; row, const EMP::Core::String&amp; table, int row_index, const EMP::Core::StringList&amp; columns) = 0;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>26</th><td class="r"><ins>virtual int GetNumRows(const EMP::Core::String&amp; table) = 0;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>27</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>28</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>29</th><td class="r"><ins>GetNumRows is the easy one - the function is passed in the name of a table, and it returns how many rows are currently in that table.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>30</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>31</th><td class="r"><ins>GetRow is the meat of the data source implementation. It takes a table, an index to a row within that table and a list of columns that are being queried. The function must look that row up and, for each column in the list, push the data into the EMP::Core::StringList ''row''.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>32</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>33</th><td class="r"><ins>=== Implementation ===</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>34</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>35</th><td class="r"><ins>So, let's convert the lackluster HighScores class to a fully-fledged EMP::Core::DataSource. First of all include EMP/Core/DataSource.h and have HighScores inherit from EMP::Core::DataSource. Take a quick look at the EMP::Core::DataSource's constructor:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>36</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>37</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>38</th><td class="r"><ins>EMP::Core::DataSource(const EMP::Core::String&amp; name = "");</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>39</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>40</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>41</th><td class="r"><ins>The name parameter that it takes is used to uniquely identify it. If this is set then we can use that name have a datagrid automatically look up our data source without any C++ code. If we don't pass in a name, then it'll default to the address of the data source object - much less useful! So it's best to call the constructor from HighScore's own constructor and pass in a name, like "high_scores".</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>42</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>43</th><td class="r"><ins>That's the basics covered, now we need to implement the two required functions. Add the GetRow and GetNumRows functions into HighScore. The implementation of these is fairly simple: GetNumRows returns the number of high scores we've got in the chart, and GetRow loops through the columns array and constructs a string for each requested column and pushes it into the passed-in string list. So you should end up with something like this:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>44</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>45</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>46</th><td class="r"><ins>void HighScores::GetRow(EMP::Core::StringList&amp; row, const EMP::Core::String&amp; table, int row_index, const EMP::Core::StringList&amp; columns)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>47</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>48</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (table == "scores")</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>49</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>50</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (size_t i = 0; i &lt; columns.size(); i++)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>51</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>52</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (columns[i] == "name")</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>53</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>54</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; row.push_back(scores[row_index].name);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>55</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>56</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if (columns[i] == "score")</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>57</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>58</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; row.push_back(EMP::Core::String(32, "%d", scores[row_index].score));</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>59</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>60</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if (columns[i] == "colour")</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>61</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>62</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EMP::Core::String colour_string;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>63</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; EMP::Core::TypeConverter&lt; EMP::Core::Colourb, EMP::Core::String &gt;::Convert(scores[row_index].colour, colour_string);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>64</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; row.push_back(colour_string);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>65</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>66</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else if (columns[i] == "wave")</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>67</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>68</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; row.push_back(EMP::Core::String(8, "%d", scores[row_index].wave));</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>69</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>70</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>71</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>72</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>73</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>74</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>75</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>76</th><td class="r"><ins>int HighScores::GetNumRows(const EMP::Core::String&amp; table)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>77</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>78</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; if (table == "scores")</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>79</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>80</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (int i = 0; i &lt; NUM_SCORES; i++)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>81</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>82</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (scores[i].score == -1)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>83</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>84</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return i;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>85</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>86</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>87</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>88</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return NUM_SCORES;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>89</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>90</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>91</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; return 0;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>92</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>93</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>94</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>95</th><td class="r"><ins>This should leave you with a compiling HighScores now that all the pure virtual functions have been implemented, and a data source that is perfectly usable. One more step remains however:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>96</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>97</th><td class="r"><ins>=== Updating the data source ===</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>98</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>99</th><td class="r"><ins>Half of the point of having data sources is allowing them to update dynamically - it's not much fun if the data can't change after it's been displayed by the datagrid. So EMP::Core::DataSource has a few protected functions that you can call to let it know that something's changed inside the source:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>100</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>101</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>102</th><td class="r"><ins>// Tells all attached listeners that one or more rows have been added to the data source.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>103</th><td class="r"><ins>void NotifyRowAdd(const String&amp; table, int first_row_added, int num_rows_added);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>104</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>105</th><td class="r"><ins>// Tells all attached listeners that one or more rows have been removed from the data source.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>106</th><td class="r"><ins>void NotifyRowRemove(const String&amp; table, int first_row_removed, int num_rows_removed);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>107</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>108</th><td class="r"><ins>// Tells all attached listeners that one or more rows have been changed in the data source.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>109</th><td class="r"><ins>void NotifyRowChange(const String&amp; table, int first_row_changed, int num_rows_changed);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>110</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>111</th><td class="r"><ins>// Tells all attached listeners that the row structure has completely changed in the data source.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>112</th><td class="r"><ins>void NotifyRowChange(const String&amp; table);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>113</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>114</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>115</th><td class="r"><ins>The first two are self-explanatory - call them after you've added or removed rows. The first RowsChanged function is to be called when you've altered some cell information in some rows, and the datagrid will refresh the contents of those rows. The second RowsChanged function should be called when everything in the data source has changed (or you don't know what's changed) - this will cause any attached datagrids to wipe their contents and start again.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>116</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>117</th><td class="r"><ins>So, out of a sense of completeness, we should add in a call to NotifyRowAdd whenever we add a row. We'd do the same if we removed or changed rows, but in this sample we just add rows. Check out the HighScores chart in the Rocket Invaders from Mars to see how NotifyRowChange is used when the player enters their name. Anyway, here's the final SubmitScore function:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>118</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>119</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>120</th><td class="r"><ins>void HighScores::SubmitScore(const EMP::Core::String&amp; name, const EMP::Core::Colourb&amp; colour, int wave, int score)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>121</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>122</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; for (size_t i = 0; i &lt; NUM_SCORES; i++)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>123</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>124</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (score &gt; scores[i].score)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>125</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>126</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // If we've already got the maximum number of scores, then we have</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>127</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // to send a RowsRemoved message as we're going to delete the last</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>128</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // row from the data source.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>129</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bool max_rows = scores[NUM_SCORES - 1].score != -1;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>130</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>131</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Push down all the other scores.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>132</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (int j = NUM_SCORES - 1; j &gt; i; j--)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>133</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>134</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scores[j] = scores[j - 1];</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>135</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>136</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>137</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Insert our new score.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>138</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scores[i].name = name;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>139</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scores[i].colour = colour;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>140</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scores[i].wave = wave;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>141</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scores[i].score = score;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>142</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>143</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Send the row removal message (if necessary).</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>144</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (max_rows)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>145</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>146</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NotifyRowRemove("scores", NUM_SCORES - 1, 1);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>147</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>148</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>149</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Then send the rows added message.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>150</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NotifyRowAdd("scores", i, 1);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>151</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>152</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>153</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>154</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; }</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>155</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>156</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>157</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>158</th><td class="r"><ins>== Step 3: The datagrid ==</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>159</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>160</th><td class="r"><ins>Now on to the datagrid. To create one of these we make a Rocket element with the tag &lt;datagrid&gt;. Inside the datagrid we can define multiple &lt;col&gt;s - each &lt;col&gt; being a column in the grid. This is what it might look like:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>161</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>162</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>163</th><td class="r"><ins>&lt;datagrid source="high_scores.scores"&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>164</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &lt;col fields="name" width="40%"&gt;Pilot:&lt;/col&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>165</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &lt;col fields="colour" width="20%"&gt;Ship:&lt;/col&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>166</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &lt;col fields="wave" width="20%"&gt;Wave:&lt;/col&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>167</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &lt;col fields="score" width="20%"&gt;Score:&lt;/col&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>168</th><td class="r"><ins>&lt;/datagrid&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>169</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>170</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>171</th><td class="r"><ins>The source attribute in the datagrid tag tells the datagrid where to fetch its data from. This is the in the format "datasource.table" - so this looks in the "scores" table, found in the "high_scores" data source. If you called your data source a different name then change this attribute.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>172</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>173</th><td class="r"><ins>Each column has a "fields" attribute - this tells the column which fields it fetches from the data source to display. This is a list in CSV form, but in this tutorial each column only fetches one field. In the Rocket Invaders from Mars sample multiple fields per column are used.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>174</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>175</th><td class="r"><ins>The "width" attribute in &lt;col&gt; instructs how much of the width of the datagrid that this column takes up.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>176</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>177</th><td class="r"><ins>Anything in between the &lt;col&gt; and &lt;/col&gt; tags is put in a header row, above all the other rows. Any RML can be put in here, and it can be left empty.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>178</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>179</th><td class="r"><ins>Running the sample with the above code will give us the following output:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>180</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>181</th><td class="r"><ins>[[Image(tutorial_datagrid_2.gif, nolink)]]</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>182</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>183</th><td class="r"><ins>Well, at least it's working. Time to pretty it up some:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>184</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>185</th><td class="r"><ins>=== Data formatters ===</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>186</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>187</th><td class="r"><ins>The third part of the datagrid system is the data formatter. A data formatter sits in between the data source and datagrid - it takes the raw field information and processes it into RML. So in this way you can turn the text returned by a column request into an icon, a button, an image with a caption, anything at all. Even another datagrid! To do this, first we go to the declaration of the datagrid in tutorial.rml and add the data formatter attribute to the ship col:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>188</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>189</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>190</th><td class="r"><ins>&lt;col fields="colour" formatter="ship" width="20%"&gt;Ship:&lt;/col&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>191</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>192</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>193</th><td class="r"><ins>This will tell the ship column to not just display the raw RGBA values that get sent back from the HighScore data source, but instead to send them to the "ship" formatter and display what that returns. Easy as that! Now all we have to do is write the ship formatter.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>194</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>195</th><td class="r"><ins>A data formatter inherits from the class Rocket::Controls::DataFormatter. It has one function that needs overriding:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>196</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>197</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>198</th><td class="r"><ins>virtual void FormatData(EMP::Core::String&amp; formatted_data, const EMP::Core::StringList&amp; raw_data) = 0;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>199</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>200</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>201</th><td class="r"><ins>This function takes a list of strings, which contains the fields from the data query. The string reference is used to return the final RML once the data has been formatted. It also has a constructor that takes a const char* (defaulting to "") in the same way as EMP::Core::DataSource. This is the name of the formatter, and is used to uniquely identify it to any datagrid columns that wish to use it.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>202</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>203</th><td class="r"><ins>So to make a new formatter, first make a new class - I called mine "HighScoresShipFormatter". Have it inherit from Rocket::Controls::DataFormatter and define the FormatData function. In the .cpp file, call the Rocket::Controls::DataFormatter constructor called from the HighScoresShipFormatter constructor with the parameter "ship". This will give it the name that the datagrid column references it by. The next step is to write the FormatData function. Very handily there's a decorator which does exactly what we want, and it's mapped to the &lt;defender&gt; tag. The decorator reads the "colour" style applied to the &lt;defender&gt; tag and colours itself based on that. So all we have to do is read the raw colour information then construct a &lt;defender&gt; tag with a style with that colour. Here's my implementation:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>204</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>205</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>206</th><td class="r"><ins>void HighScoresShipFormatter::FormatData(EMP::Core::String&amp; formatted_data, const EMP::Core::StringList&amp; raw_data)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>207</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>208</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; EMP::Core::Colourb ship_colour;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>209</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; EMPTypeConverter&lt; EMP::Core::String, EMP::Core::Colourb &gt;::Convert(raw_data[0], ship_colour);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>210</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>211</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; EMP::Core::String colour_string(32, "%d,%d,%d", ship_colour.red, ship_colour.green, ship_colour.blue);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>212</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; formatted_data = "&lt;defender style=\"color: rgb(" + colour_string + ");\" /&gt;";</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>213</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>214</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>215</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>216</th><td class="r"><ins>Then to tie it all together we need to instance the formatter. It'll automatically add itself to the formatter database, so in the main.cpp we only have to include the .h file and construct an instance after Rocket is initialised.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>217</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>218</th><td class="r"><ins>So your class should look something like this:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>219</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>220</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>221</th><td class="r"><ins>#include &lt;Rocket/Controls/DataFormatter.h&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>222</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>223</th><td class="r"><ins>class HighScoresShipFormatter : public Rocket::Controls::DataFormatter</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>224</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>225</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; public:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>226</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; HighScoresShipFormatter();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>227</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ~HighScoresShipFormatter();</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>228</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>229</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; void FormatData(EMP::Core::String&amp; formatted_data, const EMP::Core::StringList&amp; raw_data);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>230</th><td class="r"><ins>};</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>231</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>232</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>233</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>234</th><td class="r"><ins>#include &lt;EMP/Core/TypeConverter.h&gt;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>235</th><td class="r"><ins>#include "HighScoresShipFormatter.h"</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>236</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>237</th><td class="r"><ins>HighScoresShipFormatter::HighScoresShipFormatter() : Rocket::Controls::DataFormatter("ship")</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>238</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>239</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>240</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>241</th><td class="r"><ins>HighScoresShipFormatter::~HighScoresShipFormatter()</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>242</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>243</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>244</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>245</th><td class="r"><ins>void HighScoresShipFormatter::FormatData(EMP::Core::String&amp; formatted_data, const EMP::Core::StringList&amp; raw_data)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>246</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>247</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // Data format:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>248</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; // raw_data[0] is the colour, in "%d, %d, %d, %d" format.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>249</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>250</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; EMP::Core::Colourb ship_colour;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>251</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; EMP::Core::TypeConverter&lt; EMP::Core::String, EMP::Core::Colourb &gt;::Convert(raw_data[0], ship_colour);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>252</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>253</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; EMP::Core::String colour_string(32, "%d,%d,%d", ship_colour.red, ship_colour.green, ship_colour.blue);</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>254</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>255</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; formatted_data = "&lt;defender style=\"color: rgb(" + colour_string + ");\" /&gt;";</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>256</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>257</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>258</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>259</th><td class="r"><ins>Run that and you should now see the correctly formatted ship colours:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>260</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>261</th><td class="r"><ins>[[Image(tutorial_datagrid_3.gif, nolink)]]</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>262</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>263</th><td class="r"><ins>Excellent! Now to style the rest of the table.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>264</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>265</th><td class="r"><ins>== Step 4: Styling the datagrid ==</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>266</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>267</th><td class="r"><ins>The datagrid can be styled just like any other Rocket element. RCSS hooks are provided for:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>268</th><td class="r"><ins>&nbsp;- '''datagrid:''' The whole grid, including the header and all the visible rows.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>269</th><td class="r"><ins>&nbsp;- '''datagridheader:''' The top row that contains the headers for each of the columns.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>270</th><td class="r"><ins>&nbsp;- '''datagridbody:''' All the rows, excluding the header row.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>271</th><td class="r"><ins>&nbsp;- '''datagridrow:''' Each row underneath the header.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>272</th><td class="r"><ins>&nbsp;- '''datagridcell:''' Each cell inside a row.</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>273</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>274</th><td class="r"><ins>[[Image(tutorial_datagrid_4.gif, nolink)]]</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>275</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>276</th><td class="r"><ins>So, using these hooks, we can make the datagrid look pretty much any way we want it to. First, let's add a background to the body. The RCSS rule shown below will add an image background (using a tiled-box decorator) around the body, change the text to black and center it, and finally add some margins and padding to move the text within the new border:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>277</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>278</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>279</th><td class="r"><ins>datagridbody</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>280</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>281</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; color: black;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>282</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; text-align: center;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>283</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>284</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; margin-left: 4px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>285</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; margin-right: 3px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>286</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; padding: 0px 4px 4px 4px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>287</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>288</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-decorator: tiled-box;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>289</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-top-left-image: ../../../assets/invader.png 281px 275px 292px 284px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>290</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-top-right-image: ../../../assets/invader.png 294px 275px 305px 284px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>291</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-top-image: ../../../assets/invader.png stretch 292px 275px 293px 284px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>292</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-bottom-left-image: ../../../assets/invader.png 281px 285px 292px 296px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>293</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-bottom-right-image: ../../../assets/invader.png 294px 285px 305px 296px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>294</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-bottom-image: ../../../assets/invader.png stretch 292px 285px 293px 296px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>295</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-left-image: ../../../assets/invader.png stretch 281px 283px 292px 284px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>296</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-center-image: ../../../assets/invader.png stretch 292px 283px 293px 284px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>297</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>298</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>299</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>300</th><td class="r"><ins>So now it should look like this:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>301</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>302</th><td class="r"><ins>[[Image(tutorial_datagrid_5.gif, nolink)]]</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>303</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>304</th><td class="r"><ins>Much better! Header still is a bit lacking. We'll add a rule to add a tiled-horizontal decorator as a background, then some padding to bring the text inside the background:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>305</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>306</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>307</th><td class="r"><ins>datagridheader</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>308</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>309</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; width: auto;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>310</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; height: 25px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>311</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; padding: 5px 10px 0px 10px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>312</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>313</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-decorator: tiled-horizontal;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>314</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-left-image: ../../../assets/invader.png 127px 192px 143px 223px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>315</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-center-image: ../../../assets/invader.png stretch 143px 192px 145px 223px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>316</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background-right-image: ../../../assets/invader.png 145px 192px 160px 223px;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>317</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>318</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>319</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>320</th><td class="r"><ins>So now we've got the following:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>321</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>322</th><td class="r"><ins>[[Image(tutorial_datagrid_6.gif, nolink)]]</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>323</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>324</th><td class="r"><ins>Looking pretty good now. One more thing to add a bit more zing: we'll colour the even rows differently to make it easier to see the row delineations. The following rule will do exactly that:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>325</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>326</th><td class="r"><ins>{{{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>327</th><td class="r"><ins>datagrid datagridrow:nth-child(even)</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>328</th><td class="r"><ins>{</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>329</th><td class="r"><ins>&nbsp; &nbsp; &nbsp; &nbsp; background: #FFFFFFA0;</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>330</th><td class="r"><ins>}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>331</th><td class="r"><ins>}}}</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>332</th><td class="r"><ins></ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>333</th><td class="r"><ins>So finally, this is what we've come up with:</ins>&nbsp;</td></tr><tr><th>&nbsp;</th><th>334</th><td class="r"><ins></ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>335</th><td class="r"><ins>[[Image(tutorial_datagrid_7.gif, nolink)]]</ins>&nbsp;</td></tr></tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/tutorials/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
