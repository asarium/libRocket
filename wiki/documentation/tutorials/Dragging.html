
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title> Dragging - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../TracGuide.html"/><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css"/><link rel="icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="alternate" href="Dragging%3Fformat=txt" title="Plain Text" type="text/x-trac-wiki"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../documentation.html"><img id="title" src="../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/> 
<a href="../../documentation.html"><img id="rocket" src="../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/tutorials/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="../tutorials.1.html">tutorials</a> <strong>&#8249;</strong> <a href="Dragging.html">Dragging</a></div>
<div id="title"> Dragging</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<div class="wikipage">
<div id="searchable"><p>
<div class="wiki-toc"><h4>Contents</h4><ol><li><a href="Dragging.html#DragTutorial">Drag Tutorial</a><ol><li><a href="Dragging.html#Step1:Takingalook">Step 1: Taking a look</a></li><li>
<a href="Dragging.html#Step2:Addingadragproperty">Step 2: Adding a drag property</a></li><li>
<a href="Dragging.html#Step3:Listeningtotheevents">Step 3: Listening to the events</a><ol><li><a href="Dragging.html#Thedragdropevent">The 'dragdrop' event</a></li><li>
<a href="Dragging.html#Registeringthecontainers">Registering the containers</a></li></ol><li><a href="Dragging.html#Step4:Sorting">Step 4: Sorting</a></li></ol></li></ol></div>
</p>
<h1 id="DragTutorial">Drag Tutorial</h1>
<p>
libRocket has a few ways of implementing dragging of elements, such as:
</p>
<ul><li>the &lt;handle&gt; tag, as used by the documents in the sample applications
</li><li>setting an element's 'drag' property to 'drag' or 'drag-drop' and listening to the raw drag events ('dragstart', 'dragend', etc) and animating element positions manually
</li><li>setting an element's 'drag' property to 'clone'
</li></ul><p>
This tutorial shows how to use the third type, cloning, to implement dragging items between multiple inventory windows.
</p>
<h2 id="Step1:Takingalook">Step 1: Taking a look</h2>
<p>
Compile the drag tutorial (at <i>/samples/tutorials/drag/</i>) and run the program; it should end up looking like this:
</p>
<p>
<img src="../../../attachment/wiki/documentation/tutorials/Dragging/tutorial_drag_1.jpg%3Fformat=raw"/>
</p>
<p>
Take a look at the source code. As you can see, the application creates two <i>Inventory</i> objects, each of which loads a document from the 'inventory.rml' file. The application then creates four inventory objects in one of the inventories; each of these objects is a libRocket element with a tag of 'icon'. At the bottom of the 'tutorial.rcss' file you can see the properties applied to 'icon'. It is sized to 100px x 100px with a margin to separate it from its neighbour icons and a decorator for its background image. It is floated left so icons will stack from left to right in the inventory windows.
</p>
<h2 id="Step2:Addingadragproperty">Step 2: Adding a drag property</h2>
<p>
If you try dragging the icons now, nothing much happens. In the tutorial's, RCSS file add the line:
</p>
<pre class="wiki">	drag: clone;
</pre><p>
to the rule for 'icon' elements. Now try dragging the icons again; success! A clone of the icons now follows the cursor when you drag them around. We'll need to add code to listen to the end of the drag and respond accordingly, but before we get to that I'll explain how the 'drag' property works.
</p>
<p>
The 'drag' property can take several different values depending on how you want libRocket to inform you about dragging. The possible values are:
</p>
<ul><li><i>none</i>: The element does not send any drag messages. This is the default.
</li><li><i>block</i>: The element does not send any drag messages, and prevents any elements 'underneath' the element from being dragged as well. This is useful for buttons on a window's title bar, for example.
</li><li><i>drag</i>: If the left mouse button is pressed while over the element and dragged, the element will trigger a 'dragstart' event. Every subsequent time the mouse is moved, the element will trigger a 'drag' event. When the button is released, the element will trigger a 'dragend' event.
</li><li><i>drag-drop</i>: As <i>drag</i>, but as the mouse moves over other elements 'dragover' and 'dragout' events will be triggered (similarly to the 'mouseover' and 'mouseout' events). When the button is released, the element the mouse is hovering over will trigger the 'dragdrop' message.
</li><li><i>clone</i>: As <i>dragdrop</i>, but a clone of the element is attached to the mouse cursor during dragging. The clone has the pseudo-class 'drag' set on it to allow it to be differentiated from the original element.
</li></ul><p>
So both <i>drag</i> and <i>dragdrop</i> only send messages; they don't actually drag any elements anywhere automatically. Very useful for complicated dragging operations or dragging multiple elements.
</p>
<p>
The <i>clone</i> value, however, takes care of almost everything if all you need to do is drag single elements.
</p>
<h2 id="Step3:Listeningtotheevents">Step 3: Listening to the events</h2>
<p>
Now that the items can be visibly dragged around, we need to actually change their parenting when they're dropped. Create a class which inherits from Rocket::Core::EventListener and give it a static method for registering the containers. Override the ProcessEvent() function as well so we can process the 'dragdrop' event.
</p>
<pre class="wiki">#ifndef DRAGLISTENER_H
#define DRAGLISTENER_H

#include &lt;Rocket/Core/EventListener.h&gt;
#include &lt;Rocket/Core/Types.h&gt;

class DragListener : public Rocket::Core::EventListener
{
public:
	/// Registers an elemenet as being a container of draggable elements.
	static void RegisterDraggableContainer(Rocket::Core::Element* element);

protected:
	virtual void ProcessEvent(Rocket::Core::Event&amp; event);
};

#endif
</pre><p>
The RegisterDraggableContainer() function simply needs to attach the listener object to the 'dragdrop' event:
</p>
<pre class="wiki">#include "DragListener.h"
#include &lt;Rocket/Core/Element.h&gt;

static DragListener drag_listener;

// Registers an element as being a container of draggable elements.
void DragListener::RegisterDraggableContainer(Rocket::Core::Element* element)
{
	element-&gt;AddEventListener("dragdrop", &amp;drag_listener);
}
</pre><p>
The DragListener object will now receive a call to ProcessEvent() whenever an item is dropped on the registered elements or any of their children.
</p>
<h3 id="Thedragdropevent">The 'dragdrop' event</h3>
<p>
The event we'll be processing is the 'dragdrop' event. This event is sent to the element that the dragged element was dropped onto. The dragged element itself can be queried from the event as the parameter 'drag_element'.
</p>
<p>
We can now write a simple handler that will move dragged elements between the two containers:
</p>
<pre class="wiki">void DragListener::ProcessEvent(Rocket::Core::Event&amp; event)
{
	if (event == "dragdrop")
	{
		Rocket::Core::Element* dest_container = event.GetCurrentElement();
		Rocket::Core::Element* drag_element = static_cast&lt; Rocket::Core::Element* &gt;(event.GetParameter&lt; void* &gt;("drag_element", NULL));

		drag_element-&gt;GetParentNode()-&gt;RemoveChild(drag_element);
		dest_container-&gt;AppendChild(drag_element);
	}
}
</pre><p>
The dragged element is simply removed from its old parent and attached to the container it was dropped onto.
</p>
<h3 id="Registeringthecontainers">Registering the containers</h3>
<p>
All that's left to do before we can try out the dragging is to register the containers. In the constructor of the Inventory object (top of Inventory.cpp), we need to register the inventory window as a draggable container; add the following line at the end of the constructor:
</p>
<pre class="wiki">	DragListener::RegisterDraggableContainer(document-&gt;GetElementById("content"));
</pre><p>
Fire it up, start dragging and see what happens.
</p>
<p>
<img src="../../../attachment/wiki/documentation/tutorials/Dragging/tutorial_drag_2.jpg%3Fformat=raw"/>
</p>
<p>
Success!
</p>
<h2 id="Step4:Sorting">Step 4: Sorting</h2>
<p>
Currently, regardless of where you drag an item to it will end up as the last item in the window. It would be great if you could sort the items within a window by dragging them on top of each other. To do this, the ProcessEvent() function will need to determine both the container and the item within that container an element was dragged onto.
</p>
<p>
Easy! We've attached as a 'dragdrop' listener to the item containers. This means we'll be notified whenever the 'dragdrop' event is sent to the containers or any of their children (i.e., their items). Each event has a <i>target</i> element and a <i>current</i> element. The target element is the element the event was actually targetted at; in the case of 'dragdrop', the element that was dropped on. The current element is the element the processing listener is observing; in our case, the container.
</p>
<p>
So we can find the destination item and container with the following:
</p>
<pre class="wiki">void DragListener::ProcessEvent(Rocket::Core::Event&amp; event)
{
	if (event == "dragdrop")
	{
		Rocket::Core::Element* dest_container = event.GetCurrentElement();
		Rocket::Core::Element* dest_element = event.GetTargetElement();
		Rocket::Core::Element* drag_element = static_cast&lt; Rocket::Core::Element* &gt;(event.GetParameter&lt; void* &gt;("drag_element", NULL));
</pre><p>
If the dragged item is dropped directly onto a container, then the current and target elements will be the same. In this case, we want to keep the old processing:
</p>
<pre class="wiki">		if (dest_container == dest_element)
		{
			// The dragged element was dragged directly onto a container.
			drag_element-&gt;GetParentNode()-&gt;RemoveChild(drag_element);
			dest_container-&gt;AppendChild(drag_element);
		}
</pre><p>
Otherwise, we want to insert the item into its new container <i>before</i> the item it was dragged onto.
</p>
<pre class="wiki">		else
		{
			// The dragged element was dragged onto an item inside a container. In order to get the
			// element in the right place, it will be inserted into the container before the item
			// it was dragged on top of.
			Rocket::Core::Element* insert_before = dest_element;

			drag_element-&gt;GetParentNode()-&gt;RemoveChild(drag_element);
			dest_container-&gt;InsertBefore(drag_element, insert_before);
		}
</pre><p>
Run the app again and try it out. All good, except try dragging an item onto another item within the same window; in this case, it should be inserted <i>after</i> the element it is dragged onto, not before. So, just fix that up in the event handler and you're done!
</p>
<p>
You can find the fully-completed source in the drag sample.
</p>
</div>
</div>
<script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/tutorials/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
