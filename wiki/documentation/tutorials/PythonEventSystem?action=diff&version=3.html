
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title> Python Event System - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../TracGuide.html"/><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/diff.css" type="text/css"/><link rel="icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="prev" href="PythonEventSystem%3Faction=diff&amp;version=2.html" title="Version 2"/><link rel="next" href="PythonEventSystem%3Faction=diff&amp;version=4.html" title="Version 4"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../documentation.html"><img id="title" src="../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/>
<a href="../../documentation.html"><img id="rocket" src="../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/tutorials/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="../tutorials.1.html">tutorials</a> <strong>&#8249;</strong> <a href="PythonEventSystem.html">PythonEventSystem</a></div>
<div id="title"> Python Event System</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<h1>Changes between
<a href="PythonEventSystem%3Fversion=2.html">Version 2</a> and
<a href="PythonEventSystem%3Fversion=3.html">Version 3</a> of
<a href="PythonEventSystem.html">documentation/tutorials/PythonEventSystem</a></h1>
<form method="post" id="prefs" action="PythonEventSystem.html"><div><input type="hidden" name="__FORM_TOKEN" value="a669ff33c84a83d396ad829a"/></div>
<div>
<input type="hidden" name="action" value="diff"/>
<input type="hidden" name="version" value="3"/>
<input type="hidden" name="old_version" value="2"/>
<label>View differences <select name="style">
<option value="inline" selected="selected">inline</option>
<option value="sidebyside">side by side</option>
</select></label>
<div class="field">
Show <input type="text" name="contextlines" id="contextlines" size="2" maxlength="3" value="2"/>
<label for="contextlines">lines around each change</label>
</div>
<fieldset id="ignore">
<legend>Ignore:</legend>
<div class="field">
<input type="checkbox" id="blanklines" name="ignoreblanklines"/>
<label for="blanklines">Blank lines</label>
</div>
<div class="field">
<input type="checkbox" id="case" name="ignorecase"/>
<label for="case">Case changes</label>
</div>
<div class="field">
<input type="checkbox" id="whitespace" name="ignorewhitespace"/>
<label for="whitespace">White space changes</label>
</div>
</fieldset>
<div class="buttons">
<input type="submit" name="update" value="Update"/>
</div>
</div>
</form>
<dl id="overview">
<dt class="property author">Author:</dt>
<dd class="author">lloydw <span class="ipnr">(IP: 202.68.89.228)</span></dd>
<dt class="property time">Timestamp:</dt>
<dd class="time">01/09/08 11:20:58 (10 years ago)</dd>
<dt class="property message">Comment:</dt>
<dd class="message"><p>
--
</p>
</dd>
</dl>
<div class="diff">
<div id="legend">
<h3>Legend:</h3>
<dl>
<dt class="unmod"></dt><dd>Unmodified</dd>
<dt class="add"></dt><dd>Added</dd>
<dt class="rem"></dt><dd>Removed</dd>
<dt class="mod"></dt><dd>Modified</dd>
</dl>
</div>
<ul class="entries">
<li class="entry">
<h2>documentation/tutorials/PythonEventSystem</h2>
<table class="inline" summary="Differences">
<colgroup><col class="lineno"/><col class="lineno"/><col class="content"/></colgroup>
<thead><tr>
<th title="Version 2">v2</th>
<th title="Version 3">v3</th>
<th>&nbsp;</th>
</tr></thead><tbody><tr><th>53</th><th>53</th><td class="l"><span>PythonInterface::Shutdown should be called after you've released all contexts but before you call Rocket::Shutdown(). This ensures all python objects are released before rocket does its final cleanup.</span>&nbsp;</td></tr><tr><th>54</th><th>54</th><td class="l"><span></span>&nbsp;</td></tr></tbody><tbody class="add"><tr class="first"><th>&nbsp;</th><th>55</th><td class="r"><ins>At this point you'll need to add the relevant Python and Boost::Python build paths to your project and then compile and link your project.</ins>&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>56</th><td class="r"><ins></ins>&nbsp;</td></tr></tbody><tbody><tr><th>55</th><th>57</th><td class="l"><span>== Step 2: Replacing the Event System ==</span>&nbsp;</td></tr><tr><th>56</th><th>58</th><td class="l"><span></span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>57</th><th>&nbsp;</th><td class="l">We can now completely remove the exiting event system from ''RocketInvaders'' as the Python bindings will do all the event management for us. We will however need some way of starting invaders from script. I suggest you do this with an ''autoexec.py'' script, that would look something like this:&nbsp;</td></tr><tr><th>&nbsp;</th><th>59</th><td class="r">We can now completely remove the exiting event system from ''RocketInvaders'' as the Python bindings will do all the EventManagement for us. Remove all source and header files that begin with Event. You'll also need to comment out some code in GameElement.cpp and Game.cpp that call the EventManager directly. We'll get back to those later.&nbsp;</td></tr><tr><th>&nbsp;</th><th>60</th><td class="r">&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>61</th><td class="r">Also remove all the EventManager initialisation from main.cpp as we'll replace it with a new Python script. I suggest you name it ''autoexec.py'' and place it in a ''python'' subfolder. It should look something like this:&nbsp;</td></tr></tbody><tbody><tr><th>58</th><th>62</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>59</th><th>63</th><td class="l"><span>{{{</span>&nbsp;</td></tr></tbody><tbody><tr><th>73</th><th>77</th><td class="l"><span>&nbsp; &nbsp; if (!module)</span>&nbsp;</td></tr><tr><th>74</th><th>78</th><td class="l"><span>&nbsp; &nbsp; {</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>75</th><th>&nbsp;</th><td class="l">&nbsp; &nbsp; &nbsp; &nbsp; P<del>rintError</del>();&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>79</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; P<ins>yErr_Print</ins>();&nbsp;</td></tr></tbody><tbody><tr><th>76</th><th>80</th><td class="l"><span>&nbsp; &nbsp; &nbsp; &nbsp; return false;</span>&nbsp;</td></tr><tr><th>77</th><th>81</th><td class="l"><span>&nbsp; &nbsp; }</span>&nbsp;</td></tr></tbody><tbody><tr><th>86</th><th>90</th><td class="l"><span>}}}</span>&nbsp;</td></tr><tr><th>87</th><th>91</th><td class="l"><span></span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>88</th><th>&nbsp;</th><td class="l">At this point the ''RocketInvaders'' will now run, however you'll get a nasty script error as Python attempts to execute the ''onload'' event in mainmenu.rml. Update the ''onload'' and ''onunload'' events to use Python script which will correctly display and hide the logo.&nbsp;</td></tr><tr><th>&nbsp;</th><th>92</th><td class="r">At this point the ''RocketInvaders'' will now run, however you'll get a script import error because ''autoexec'' cannot be found. To fix this we'll need to add the ''python'' folder to our Python search path.&nbsp;</td></tr><tr><th>&nbsp;</th><th>93</th><td class="r">&nbsp;</td></tr><tr><th>&nbsp;</th><th>94</th><td class="r">''NOTE: On Windows this error will go to stdout, which will not be visible. I suggest you grab a copy of DoAllocConsole() from the pyinvaders sample and drop it into your project. Call DoAllocConsole() at the start of your main function and you'll get a console for reading python error messages.''&nbsp;</td></tr><tr><th>&nbsp;</th><th>95</th><td class="r">&nbsp;</td></tr><tr><th>&nbsp;</th><th>96</th><td class="r">My PythonInterface::Initialise now looks like this:&nbsp;</td></tr><tr><th>&nbsp;</th><th>97</th><td class="r">{{{&nbsp;</td></tr><tr><th>&nbsp;</th><th>98</th><td class="r">bool PythonInterface::Initialise()&nbsp;</td></tr><tr><th>&nbsp;</th><th>99</th><td class="r">{&nbsp;</td></tr><tr><th>&nbsp;</th><th>100</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; // Initialise Python.&nbsp;</td></tr><tr><th>&nbsp;</th><th>101</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; Py_Initialize();&nbsp;</td></tr><tr><th>&nbsp;</th><th>102</th><td class="r">&nbsp;</td></tr><tr><th>&nbsp;</th><th>103</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; // Setup the Python search path.&nbsp;</td></tr><tr><th>&nbsp;</th><th>104</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; const char* python_path = Py_GetPath();&nbsp;</td></tr><tr><th>&nbsp;</th><th>105</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; char buffer[1024];&nbsp;</td></tr><tr><th>&nbsp;</th><th>106</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; snprintf(buffer, 1024, "../samples/invaders/python;%s", python_path);&nbsp;</td></tr><tr><th>&nbsp;</th><th>107</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; buffer[1023] = '\0';&nbsp;</td></tr><tr><th>&nbsp;</th><th>108</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; PySys_SetPath(buffer);&nbsp;</td></tr><tr><th>&nbsp;</th><th>109</th><td class="r">&nbsp;</td></tr><tr><th>&nbsp;</th><th>110</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; // Import Rocket.&nbsp;</td></tr><tr><th>&nbsp;</th><th>111</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; if (!Import("rocket"))&nbsp;</td></tr><tr><th>&nbsp;</th><th>112</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return false;&nbsp;</td></tr><tr><th>&nbsp;</th><th>113</th><td class="r">&nbsp;</td></tr><tr><th>&nbsp;</th><th>114</th><td class="r">&nbsp; &nbsp; &nbsp; &nbsp; return true;&nbsp;</td></tr><tr><th>&nbsp;</th><th>115</th><td class="r">}&nbsp;</td></tr><tr><th>&nbsp;</th><th>116</th><td class="r">}}}&nbsp;</td></tr><tr><th>&nbsp;</th><th>117</th><td class="r">&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>118</th><td class="r">This will get us further, you should see the main menu load, however you'll notice a python error on your console when Python attempts to execute the old ''onload'' event in mainmenu.rml. Update the ''onload'' and ''onunload'' events to use Python script which will correctly display and hide the logo.&nbsp;</td></tr></tbody><tbody><tr><th>89</th><th>119</th><td class="l"><span>{{{</span>&nbsp;</td></tr><tr><th>90</th><th>120</th><td class="l"><span>&lt;body template="window" onload="document.context.LoadDocument('data/logo.rml').Show()" onunload="document.context.logo.Close()"&gt;</span>&nbsp;</td></tr></tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/tutorials/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
