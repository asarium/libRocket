
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title> Proxy Tables - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../TracGuide.html"/><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/diff.css" type="text/css"/><link rel="icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="prev" href="ProxyTables%3Faction=diff&amp;version=2.html" title="Version 2"/><link rel="next" href="ProxyTables%3Faction=diff&amp;version=4.html" title="Version 4"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../documentation.html"><img id="title" src="../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
 <li><a href="../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/>
<a href="../../documentation.html"><img id="rocket" src="../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/LuaManual/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="../LuaManual.html">LuaManual</a> <strong>&#8249;</strong> <a href="ProxyTables.html">ProxyTables</a></div>
<div id="title"> Proxy Tables</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<h1>Changes between
<a href="ProxyTables%3Fversion=2.html">Version 2</a> and
<a href="ProxyTables%3Fversion=3.html">Version 3</a> of
<a href="ProxyTables.html">documentation/LuaManual/ProxyTables</a></h1>
<form method="post" id="prefs" action="ProxyTables.html"><div><input type="hidden" name="__FORM_TOKEN" value="a669ff33c84a83d396ad829a"/></div>
<div>
<input type="hidden" name="action" value="diff"/>
<input type="hidden" name="version" value="3"/>
<input type="hidden" name="old_version" value="2"/>
<label>View differences <select name="style">
<option value="inline" selected="selected">inline</option>
<option value="sidebyside">side by side</option>
</select></label>
<div class="field">
Show <input type="text" name="contextlines" id="contextlines" size="2" maxlength="3" value="2"/>
<label for="contextlines">lines around each change</label>
</div>
<fieldset id="ignore">
<legend>Ignore:</legend>
<div class="field">
<input type="checkbox" id="blanklines" name="ignoreblanklines"/>
<label for="blanklines">Blank lines</label>
</div>
<div class="field">
<input type="checkbox" id="case" name="ignorecase"/>
<label for="case">Case changes</label>
</div>
<div class="field">
<input type="checkbox" id="whitespace" name="ignorewhitespace"/>
<label for="whitespace">White space changes</label>
</div>
</fieldset>
<div class="buttons">
<input type="submit" name="update" value="Update"/>
</div>
</div>
</form>
<dl id="overview">
<dt class="property author">Author:</dt>
<dd class="author">gambini <span class="ipnr">(IP: 96.38.104.126)</span></dd>
<dt class="property time">Timestamp:</dt>
<dd class="time">05/29/12 17:27:07 (5 years ago)</dd>
<dt class="property message">Comment:</dt>
<dd class="message"><p>
--
</p>
</dd>
</dl>
<div class="diff">
<div id="legend">
<h3>Legend:</h3>
<dl>
<dt class="unmod"></dt><dd>Unmodified</dd>
<dt class="add"></dt><dd>Added</dd>
<dt class="rem"></dt><dd>Removed</dd>
<dt class="mod"></dt><dd>Modified</dd>
</dl>
</div>
<ul class="entries">
<li class="entry">
<h2>documentation/LuaManual/ProxyTables</h2>
<table class="inline" summary="Differences">
<colgroup><col class="lineno"/><col class="lineno"/><col class="content"/></colgroup>
<thead><tr>
<th title="Version 2">v2</th>
<th title="Version 3">v3</th>
<th>&nbsp;</th>
</tr></thead><tbody class="mod"><tr class="first"><th>1</th><th>&nbsp;</th><td class="l">== Proxy Tables ==&nbsp;</td></tr><tr><th>2</th><th>&nbsp;</th><td class="l">== Problem to solve ==&nbsp;</td></tr><tr><th>3</th><th>&nbsp;</th><td class="l">The problem with Lua tables is that building them isn't an inexpensive operation when done once per frame, or even once per event if it is a large table. When a property or function in Lua calls in to C++ and that function would return a collection of items, proxy tables will forgo the table building unless explicitly told to do so.&nbsp;</td></tr><tr><th>4</th><th>&nbsp;</th><td class="l">&nbsp;</td></tr><tr><th>5</th><th>&nbsp;</th><td class="l">This is one of the more noticeable areas where the Lua implementation varies from Python, and subsequently Javascript.[wiki:documentation/LuaManual/ProxyTables#Why Why?]&nbsp;</td></tr><tr><th>6</th><th>&nbsp;</th><td class="l">&nbsp;</td></tr><tr><th>7</th><th>&nbsp;</th><td class="l">== How ==&nbsp;</td></tr><tr><th>8</th><th>&nbsp;</th><td class="l">All proxy tables will override the usual ''!__index'' and/or ''!__newindex'' Lua metamethods. They hook in to the access and setting of tables when the items don't exist directly in the table. At all times, the table of a proxy table will be similar to&nbsp;</td></tr><tr><th>9</th><th>&nbsp;</th><td class="l">{{{&nbsp;</td></tr><tr><th>10</th><th>&nbsp;</th><td class="l">proxy_table = &nbsp;</td></tr><tr><th>11</th><th>&nbsp;</th><td class="l">{ &nbsp;</td></tr><tr><th>12</th><th>&nbsp;</th><td class="l">GetTable = function() call_c_function() end &nbsp;</td></tr><tr><th>13</th><th>&nbsp;</th><td class="l">__index = function() __index_function_in_c() end&nbsp;</td></tr><tr><th>14</th><th>&nbsp;</th><td class="l">__newindex = function() __newindex_function_in_c() end&nbsp;</td></tr><tr><th>15</th><th>&nbsp;</th><td class="l">}&nbsp;</td></tr><tr><th>16</th><th>&nbsp;</th><td class="l">--userdata has a reference to the C++ pointer object to retrieve the data from&nbsp;</td></tr><tr><th>17</th><th>&nbsp;</th><td class="l">userdata:setmetatable(proxy_table) &nbsp;</td></tr><tr><th>18</th><th>&nbsp;</th><td class="l">}}}&nbsp;</td></tr><tr><th>19</th><th>&nbsp;</th><td class="l">It is done all in C++, so that is not exactly how that happens, but it is an accurate enough representation for why the next example would trigger the ''!__index'' and ''!__newindex'' metamethods.&nbsp;</td></tr><tr><th>20</th><th>&nbsp;</th><td class="l">{{{&nbsp;</td></tr><tr><th>21</th><th>&nbsp;</th><td class="l">--userdata is the same as the previous code block, with proxy_table&nbsp;</td></tr><tr><th>22</th><th>&nbsp;</th><td class="l">--as the metatable&nbsp;</td></tr><tr><th>23</th><th>&nbsp;</th><td class="l">local item = userdata["name"]&nbsp;</td></tr><tr><th>24</th><th>&nbsp;</th><td class="l">--or&nbsp;</td></tr><tr><th>25</th><th>&nbsp;</th><td class="l">local item = userdata.name&nbsp;</td></tr><tr><th>26</th><th>&nbsp;</th><td class="l">--or&nbsp;</td></tr><tr><th>27</th><th>&nbsp;</th><td class="l">local item = userdata[3]&nbsp;</td></tr><tr><th>28</th><th>&nbsp;</th><td class="l">--newindexes&nbsp;</td></tr><tr><th>29</th><th>&nbsp;</th><td class="l">userdata["name"] = "apple"&nbsp;</td></tr><tr><th>30</th><th>&nbsp;</th><td class="l">userdata.name = "orange"&nbsp;</td></tr><tr><th>31</th><th>&nbsp;</th><td class="l">userdtata[2] = "banana"&nbsp;</td></tr><tr><th>32</th><th>&nbsp;</th><td class="l">--&nbsp;</td></tr><tr><th>33</th><th>&nbsp;</th><td class="l">local item = userdata.name --would still trigger an __index metamethod, but still return 'orange'&nbsp;</td></tr><tr><th>34</th><th>&nbsp;</th><td class="l">}}}&nbsp;</td></tr><tr><th>35</th><th>&nbsp;</th><td class="l">Because ''name'' and ''3'' doesn't exist on the actual table, it triggers the metamethods. The ''!__newindex'' does NOT actually add the item to the table, only adds the item to the C++ object using appropriate get/set methods available.&nbsp;</td></tr><tr><th>36</th><th>&nbsp;</th><td class="l">&nbsp;</td></tr><tr><th>37</th><th>&nbsp;</th><td class="l">== I want the actual table ==&nbsp;</td></tr><tr><th>38</th><th>&nbsp;</th><td class="l">Getting the actual table is no problem. Every single proxy table has a method named ''GetTable()''. This will build a table of key,value pairs. Depending on the needs, sometimes the tables are indexed by both integer keys and string keys. In this case, a table value is duplicated and set to both the integer and string indexes.&nbsp;</td></tr><tr><th>39</th><th>&nbsp;</th><td class="l">&nbsp;</td></tr><tr><th>40</th><th>&nbsp;</th><td class="l">Using the ''GetTable()'' function is the only way to to be able to iterate over the table, but beware of the ones that are indexed by both integer keys and string keys. If using pairs(), then iteration will hit each value twice: once for its integer key and once for its string key. To hit each value only once, use ipairs() to iterate only over the integer keys.&nbsp;</td></tr><tr><th>&nbsp;</th><th>1</th><td class="r">= Proxy Tables =&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>2</th><td class="r">When iterating over a table returned from a select few properties, you '''must''' use ''ipairs'' or ''pairs'' rather than ''foreach'', ''next'', or whatever else exists. The "tables" are actually userdata containing C++ pointers.&nbsp;</td></tr></tbody><tbody><tr><th>41</th><th>3</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>42</th><th>4</th><td class="l"><span>== Why ==</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>43</th><th>&nbsp;</th><td class="l">The Lua language is fairly simple. It does not have an iterator metamethod like it does for some other operations<del>, and because of this, the ''GetTable()'' method exists for proxy tables. It is a tradeoff of performance for being a little less intuitive. However, accessing individual items is fast and intuitive, because the syntax is the same as if it were an actual value in the table</del>.&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>5</th><td class="r">The Lua language is fairly simple. It does not have an iterator metamethod like it does for some other operations<ins>. Because of this, __pairs and __ipairs are pseudo-metamethods that exist for proxy tables. It is a tradeoff of performance for being a little less flexible. However, since Lua's ''foreach'' is being depreciated, there is almost no reason to not use ''ipairs'' or ''pairs''</ins>.&nbsp;</td></tr></tbody><tbody><tr><th>44</th><th>6</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>45</th><th>7</th><td class="l"><span>== List of proxy tables ==</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>46</th><th>&nbsp;</th><td class="l">This is an exhaustive list of <del>functions and properties that return</del> proxy tables. If you think that this is out of date or incorrect, then the file names in the source code will tell you if you are correct. If the file name ends with "Proxy.cpp", then it is proxy table, with the exception of "ElementStyle.cpp".&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>8</th><td class="r">This is an exhaustive list of <ins>everything that returns</ins> proxy tables. If you think that this is out of date or incorrect, then the file names in the source code will tell you if you are correct. If the file name ends with "Proxy.cpp", then it is proxy table, with the exception of "ElementStyle.cpp".&nbsp;</td></tr></tbody><tbody><tr><th>47</th><th>9</th><td class="l"><span></span>&nbsp;</td></tr><tr><th>48</th><th>10</th><td class="l"><span>{{{</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>49</th><th>&nbsp;</th><td class="l">Context.documents --read<del> </del>only, index by integer and string&nbsp;</td></tr><tr><th>50</th><th>&nbsp;</th><td class="l">Element.attributes --read<del> </del>only, index by string&nbsp;</td></tr><tr><th>51</th><th>&nbsp;</th><td class="l">Element.child_nodes --read<del> </del>only, index by integer&nbsp;</td></tr><tr><th>&nbsp;</th><th>11</th><td class="r">Context.documents --read<ins>-</ins>only, index by integer and string&nbsp;</td></tr><tr><th>&nbsp;</th><th>12</th><td class="r">Element.attributes --read<ins>-</ins>only, index by string&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>13</th><td class="r">Element.child_nodes --read<ins>-</ins>only, index by integer&nbsp;</td></tr></tbody><tbody><tr><th>52</th><th>14</th><td class="l"><span>Element.style --read &amp; write, index by string</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>53</th><th>&nbsp;</th><td class="l">Event.parameters --read<del> </del>only, index by string&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>15</th><td class="r">Event.parameters --read<ins>-</ins>only, index by string&nbsp;</td></tr></tbody><tbody><tr><th>54</th><th>16</th><td class="l"><span>--From RocketControls</span>&nbsp;</td></tr><tr><th>55</th><th>17</th><td class="l"><span>ElementFormControlSelect.options --[[read only, index by integer</span>&nbsp;</td></tr><tr><th>56</th><th>18</th><td class="l"><span>&nbsp; &nbsp; &nbsp; each index item is a table with two named values, {"element"=Element,"value"=string} ]]</span>&nbsp;</td></tr><tr><th>57</th><th>19</th><td class="l"><span>}}}</span>&nbsp;</td></tr></tbody><tbody class="mod"><tr class="first"><th>58</th><th>&nbsp;</th><td class="l">A function that returns a table that is NOT a proxy table is ''rocket.contexts''. It is read only and indexed by both string and integer.&nbsp;</td></tr><tr><th>&nbsp;</th><th>20</th><td class="r">&nbsp;</td></tr><tr class="last"><th>&nbsp;</th><th>21</th><td class="r">If you try to use ''ipairs'' on a proxy table that is only indexed by string, then you will iterate over no items. If you use ''pairs'' on a proxy table that is only indexed by integer, then you will iterate over all of the items, just like you would expect. &nbsp;</td></tr></tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/LuaManual/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
