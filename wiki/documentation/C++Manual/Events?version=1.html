
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title> Events - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../TracGuide.html"/><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css"/><link rel="icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="alternate" href="Events%3Fversion=1&amp;format=txt" title="Plain Text" type="text/x-trac-wiki"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../documentation.html"><img id="title" src="../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/>
<a href="../../documentation.html"><img id="rocket" src="../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/C%2B%2BManual/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual">C++Manual</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual/Events">Events</a></div>
<div id="title"> Events</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<table id="info" summary="Revision info"><tbody><tr>
<th scope="col">
Version 1 (modified by peterc, 10 years ago)
</th></tr><tr>
<td class="message">--</td>
</tr>
</tbody></table>
<div class="wikipage">
<div id="searchable"><p>
<div class="wiki-toc"><h4>Contents</h4><ol><li><a href="Events%3Fversion=1.html#Events">Events</a><ol><li><a href="Events%3Fversion=1.html#Eventinterface">Event interface</a></li><li>
<a href="Events%3Fversion=1.html#Eventlisteners">Event listeners</a><ol><li><a href="Events%3Fversion=1.html#Attachingtoanelement">Attaching to an element</a></li><li>
<a href="Events%3Fversion=1.html#Detachingfromanelement">Detaching from an element</a></li></ol><li><a href="Events%3Fversion=1.html#Sendingevents">Sending events</a></li><li>
<a href="Events%3Fversion=1.html#Customevents">Custom events</a><ol><li><a href="Events%3Fversion=1.html#Creatingacustomeventinstancer">Creating a custom event instancer</a></li><li>
<a href="Events%3Fversion=1.html#Registeringaninstancer">Registering an instancer</a></li></ol><li><a href="Events%3Fversion=1.html#Inlineevents">Inline events</a><ol><li><a href="Events%3Fversion=1.html#Creatingacustomeventlistenerinstancer">Creating a custom event listener instancer</a></li></ol></li></ol></li></ol></div>
</p>
<h1 id="Events">Events</h1>
<p>
Events are sent to elements to indicate actions that have occurred to that element. Rocket generates many events internally (these are fully specified in the <a class="wiki" href="../RML/Events.html">RML events documentation</a>). The application can also send arbitrary events to elements.
</p>
<p>
When an event is dispatched to an element, it first goes through a <i>bubble</i> phase where the each of the element's ancestors has an opportunity to process the event and stop the propagation. The event is then sent to the target element, then goes through a <i>capture</i> phase where it falls back to its root ancestor.
</p>
<p>
Events are identified by a descriptive string name (such as "keydown", "blur", etc) and a dictionary of parameters that further describe the event. For example, the "keydown" event has parameters for identifying the actual key that was pressed and the state of the key modifiers.
</p>
<p>
Events can be handled internally by the elements they are sent to or by an event listener object. An event listener is able to subscribe to specific events on an element and will be notified whenever those events occur.
</p>
<h2 id="Eventinterface">Event interface</h2>
<p>
An event is represented by the Rocket::Core::Event structure, defined in Rocket/Core/Event.h. The public interface to an event object is:
</p>
<pre class="wiki">class Event
{
public:
	enum EventPhase { PHASE_UNKNOWN, PHASE_CAPTURE, PHASE_TARGET, PHASE_BUBBLE };

	// Get the current propagation phase.
	// @return Current phase the event is in.
	Rocket::Core::Event::EventPhase GetPhase() const;

	// Get the current element in the propagation.
	// @return The current element in propagation.
	Rocket::Core::Element* GetCurrentElement() const;

	// Get the target element.
	// @return The target element of this event.
	Rocket::Core::Element* GetTargetElement() const;

	// Get the event type.
	// @return The event type.
	const EMP::Core::String&amp; GetType() const;

	// Returns the value of one of the event's parameters.
	// @param key[in] The name of the desired parameter.
	// @return The value of the requested parameter.
	template &lt; typename T &gt;
	T GetParameter(const EMP::Core::String&amp; key, const T&amp; default_value);

	// Stops the propagation of the event.
	void StopPropagation();
};
</pre><p>
The <i>phase</i> of the event, returned by GetPhase(), will be PHASE_CAPTURE if the event listener received the event during the capture phase or PHASE_BUBBLE if during the bubbling phase.
</p>
<p>
The <i>target element</i>, returned by GetTargetElement(), is the element the event was originally sent to. The <i>current element</i>, returned by GetCurrentElement(), is the element the event is currently being sent to. This may be the target element or one of the target element's ancestors.
</p>
<p>
The name of the event ("keydown", "focus", etc) is returned from GetType(). You can also use the equality operator to compare an event directly with a string.
</p>
<p>
You can fetch the parameters of the event with the templated GetParameter() function. The exact parameters of each event are detailed in the <a class="wiki" href="../RML/Events.html">event documentation</a>.
</p>
<p>
For event types that can be interrupted, a listener can call the StopPropagation() function on an event to prevent the event's progress through the event cycle.
</p>
<h2 id="Eventlisteners">Event listeners</h2>
<p>
Any object that wants to listen for events derives from Rocket::Core::EventListener, and implements the one required pure virtual function:
</p>
<pre class="wiki">// Process the incoming event.
virtual void ProcessEvent(Rocket::Core::Event&amp; event) = 0;
</pre><p>
The ProcessEvent() function will be called every time a relevant event is sent to an element the listener is subscribed to.
</p>
<h3 id="Attachingtoanelement">Attaching to an element</h3>
<p>
To subscribe an event listener to an element, call the AddEventListener() function on the element to attach to.
</p>
<pre class="wiki">// Adds an event listener to this element.
// @param[in] event Event to attach to.
// @param[in] listener The listener object to be attached.
// @param[in] in_capture_phase True to attach in the capture phase, false in bubble phase.
void AddEventListener(const EMP::Core::String&amp; event,
                      Rocket::Core::EventListener* listener,
                      bool in_capture_phase = false);
</pre><p>
The function takes the following parameters:
</p>
<ul><li><i>event</i>: The string name of the event the listener wants to attach to, for example "keydown", "focus", etc.
</li><li><i>listener</i>: The event listener object to attach.
</li><li><i>in_capture_phase</i>: If true, the event listener will receive the event in the capture phase, otherwise, in the bubbling phase. See the [<a class="wiki" href="../RML/Events.html">RML event documentation</a> for more information.
</li></ul><h3 id="Detachingfromanelement">Detaching from an element</h3>
<p>
To unsubscribe an event listener from an element, call the RemoveEventListener() function on the element:
</p>
<pre class="wiki">// Removes an event listener from this element.
// @param[in] event Event to detach from.
// @param[in] listener The listener object to be detached.
// @param[in] in_capture_phase True to detach from the capture phase, false from the bubble phase.
void RemoveEventListener(const EMP::Core::String&amp; event,
                         Rocket::Core::EventListener* listener,
                         bool in_capture_phase = false);
</pre><h2 id="Sendingevents">Sending events</h2>
<p>
The application can send an arbitrary event to an element through the DispatchEvent() function on Rocket::Core::Element.
</p>
<pre class="wiki">// Sends an event to this element.
// @param[in] event Name of the event in string form.
// @param[in] parameters The event parameters.
// @param[in] interruptible True if the propagation of the event be stopped.
void DispatchEvent(const EMP::Core::String&amp; event,
                   const EMP::Core::Dictionary&amp; parameters,
                   bool interruptible = false);
</pre><p>
The event will be created and sent through the standard event loop. The following example sends a "close" event to an element:
</p>
<pre class="wiki">EMP::Core::Dictionary parameters;
parameters.Set("source", "user");

element-&gt;DispatchEvent("close", parameters);
</pre><h2 id="Customevents">Custom events</h2>
<p>
Events are instanced through an event instancer similarly to contexts. The instancer can be overridden with a custom instancer if a custom event is required; this is generally only needed to integrate a scripting language into Rocket.
</p>
<p>
A custom event inherits from Rocket::Core::Event. There are no virtual functions to be overridden.
</p>
<h3 id="Creatingacustomeventinstancer">Creating a custom event instancer</h3>
<p>
A custom event instancer needs to be created and registered with the Rocket factory in order to have custom events instanced. A custom event instancer derives from Rocket::Core::EventInstancer and implements the required pure virtual functions:
</p>
<pre class="wiki">// Instance an event object.
// @param[in] target Target element of this event.
// @param[in] name Name of this event.
// @param[in] parameters Additional parameters for this event.
// @param[in] interruptible If the event propagation can be stopped.
virtual Rocket::Core::Event* InstanceEvent(Rocket::Core::Element* target,
                                           const EMP::Core::String&amp; name,
                                           const EMP::Core::Dictionary&amp; parameters,
                                           bool interruptible) = 0;

// Releases an event instanced by this instancer.
// @param[in] event The event to release.
virtual void ReleaseEvent(Event* event) = 0;

// Releases this event instancer.
virtual void Release() = 0;
</pre><p>
InstanceEvent() will be called whenever the factory is called upon to instance an event. The parameters to the function are:
</p>
<ul><li><i>target</i>: The element the event is begin targeted at.
</li><li><i>name</i>: The name of the event ("keydown", "focus", etc).
</li><li><i>parameters</i>: The parameters to the event as a dictionary.
</li><li><i>interruptible</i>: True if the event can be interrupted (ie, prevented from propagating throughout the entire event cycle), false if not.
</li></ul><p>
If InstanceEvent() is successful, return the new event. Otherwise, return NULL (0) to indicate an instancing error.
</p>
<p>
ReleaseEvent() will be called when an event instanced through the instancer is no longer required by the system. It should be deleted appropriately.
</p>
<p>
Release() will be called when the event instancer is no longer required, usually when Rocket is shut down. The instancer should delete itself as appropriate.
</p>
<h3 id="Registeringaninstancer">Registering an instancer</h3>
<p>
To register a custom instancer with Rocket, call the RegisterEventInstancer() function on the Rocket factory (Rocket::Core::Factory) after Rocket has been initialised.
</p>
<pre class="wiki">// Registers an instancer for all events.
// @param[in] instancer The instancer to be called.
// @return The registered instanced on success, NULL on failure.
static Rocket::Core::EventInstancer* RegisterEventInstancer(Rocket::Core::EventInstancer* instancer);
</pre><p>
Like other instancers, the event instancer is reference counted. Remember to remove the initial reference after you register a custom instancer with the factory.
</p>
<h2 id="Inlineevents">Inline events</h2>
<p>
Event responses can be specified as element attributes inside RML, similarly to HTML. For example, in the following RML fragment a response is given to the "click" event.
</p>
<pre class="wiki">&lt;rml&gt;
	&lt;head&gt;
	&lt;/head&gt;
	&lt;body&gt;
		&lt;button onclick="game.start()"&gt;Start Game&lt;/button&gt;
...
</pre><p>
Notice the "on" prefix before the event name of "click". All event bindings from RML are prefixed this way.
</p>
<p>
Rocket sends inline events to event listener proxy objects that are created by the application. An application must therefore register a custom event listener instancer to have an opportunity to interpret the events.
</p>
<h3 id="Creatingacustomeventlistenerinstancer">Creating a custom event listener instancer</h3>
<p>
A custom event listener instancer derives from Rocket::Core::EventListenerInstancer. The following pure virtual functions must be implemented:
</p>
<pre class="wiki">// Instance an event listener object.
// @param value Value of the event.
virtual Rocket::Core::EventListener* InstanceEventListener(const EMP::Core::String&amp; value) = 0;

// Releases this event listener instancer.
virtual void Release() = 0;
</pre><p>
InstanceEventListener() will be called during RML parsing whenever the factory needs to find an event listener for an inline event. The parameter <i>value</i> will be the raw event response string as specified in the RML.
</p>
<p>
Release() will be called when the event instancer is no longer required, usually when Rocket is shut down. The instancer should delete itself as appropriate.
</p>
</div>
</div>
<script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/C%2B%2BManual/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
