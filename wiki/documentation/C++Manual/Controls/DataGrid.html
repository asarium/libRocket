
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title> Data Grid - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../../TracGuide.html"/><link rel="stylesheet" href="../../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../../chrome/common/css/wiki.css" type="text/css"/><link rel="icon" href="../../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="alternate" href="DataGrid%3Fformat=txt" title="Plain Text" type="text/x-trac-wiki"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../../documentation.html"><img id="title" src="../../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/>
<a href="../../../documentation.html"><img id="rocket" src="../../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/C%2B%2BManual/Controls/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual">C++Manual</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual/Controls">Controls</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual/Controls/DataGrid">DataGrid</a></div>
<div id="title"> Data Grid</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<div class="wikipage">
<div id="searchable"><p>
<div class="wiki-toc"><h4>Contents</h4><ol><li><a href="DataGrid.html#Datagrid">Data grid</a><ol><li><a href="DataGrid.html#Datasources">Data sources</a><ol><li><a href="DataGrid.html#Notifyingofchanges">Notifying of changes</a></li></ol><li><a href="DataGrid.html#Specifyingadatagrid">Specifying a data grid</a><ol><li><a href="DataGrid.html#Addingcolumns">Adding columns</a></li></ol><li><a href="DataGrid.html#Dataformatters">Data formatters</a></li><li>
<a href="DataGrid.html#Applyingproperties">Applying properties</a></li></ol></li></ol></div>
</p>
<h1 id="Datagrid">Data grid</h1>
<p>
The Controls plugin includes the data grid element, an element capable of fetching, positioning and rendering dynamic tabulated data. Data grids read their content from <i>data sources</i>. The class <i>Rocket::Controls::ElementDataGrid</i> is the interface for data grid elements.
</p>
<p>
The following diagram summarises the interaction between the objects described below in the data grid system.
<img src="../../../../attachment/wiki/documentation/C++Manual/Controls/DataGrid/controls_datagrid_1.gif%3Fformat=raw"/>
</p>
<p>
Note: an excellent way to learn how to use data grids and data sources is the <a class="wiki" href="../../tutorials/Datagrid.html">data grid tutorial</a>. This shows you how to build up a data source and create a data grid to read from it.
</p>
<h2 id="Datasources">Data sources</h2>
<p>
Data sources are named database-like objects that store tables of data, each of which can be queried row by row. Each table contains several named columns of data per row. Listeners can attach to data sources to be notified when changes to the data occur. All data sources derive from the <i>EMP::Core::DataSource</i> class. The constructor for the base class takes a unique string which is used to identify the data source. Concrete data sources must provide implementations for the pure virtual functions:
</p>
<pre class="wiki">// Fetches the contents of one row of a table within the data source.
// @param[out] row The list of values in the table.
// @param[in] table The name of the table to query.
// @param[in] row_index The index of the desired row.
// @param[in] columns The list of desired columns within the row.
virtual void GetRow(EMP::Core::StringList&amp; row,
                    const EMP::Core::String&amp; table,
                    int row_index,
                    const EMP::Core::StringList&amp; columns) = 0;

// Fetches the number of rows within one of this data source's tables.
// @param[in] table The name of the table to query.
// @return The number of rows within the specified table.
virtual int GetNumRows(const EMP::Core::String&amp; table) = 0;
</pre><p>
<i>GetRow()</i> is called by the data grid when it needs to fetch the source's values. The parameters to the function are:
</p>
<ul><li><i>row</i>: A list of strings that the data source must write the row's contents to. Which columns of data are to be written, and in which order, is specified by the <i>columns</i> parameter.
</li><li><i>table</i>: Which table within the data source the data grid is requesting data from. This is only important if a single data source object is supporting multiple tables.
</li><li><i>row_index</i>: The zero-based index of the row the data source is requesting.
</li><li><i>columns</i>: An ordered list of which columns the data grid wants the values for.
</li></ul><p>
<i>GetNumRows()</i> is called by the data grid when it needs to know how many entries a certain table within a data source is.
</p>
<h3 id="Notifyingofchanges">Notifying of changes</h3>
<p>
In order for an attached data grid to remain up-to-date, data sources need to inform their listeners when alterations occur to their data. There are several protected methods available to a data source for doing this:
</p>
<pre class="wiki">// Tells all attached listeners that one or more rows have been added/ to the data source.
// @param[in] table The name of the table to have rows added to it.
// @param[in] first_row_added The index of the first row added.
// @param[in] num_rows_added The number of rows added (including the first row).
void NotifyRowAdd(const EMP::Core::String&amp; table,
               int first_row_added,
               int num_rows_added);
</pre><p>
The <i>NotifyRowAdd()</i> function informs an attached data grid that a number of rows have been inserted into one of the tables.
</p>
<pre class="wiki">// Tells all attached listeners that one or more rows have been removed from the data source.
// @param[in] table The name of the table to have rows removed from it.
// @param[in] first_row_removed The index of the first row removed.
// @param[in] num_rows_removed The number of rows removed (including the first row).
void NotifyRowRemove(const EMP::Core::String&amp; table,
                 int first_row_removed,
                 int num_rows_removed);
</pre><p>
The <i>NotifyRowRemove()</i> function informs an attached data grid that a number of rows have been removed from one of the tables.
</p>
<pre class="wiki">// Tells all attached listeners that one or more rows have been changed in the data source.
// @param[in] table The name of the table to have rows changed in it.
// @param[in] first_row_changed The index of the first row changed.
// @param[in] num_rows_changed The number of rows changed (including the first row).
void NotifyRowChange(const EMP::Core::String&amp; table,
                 int first_row_changed,
                 int num_rows_changed);
</pre><p>
The <i>NotifyRowChange()</i> function informs an attached data grid that a number of rows have changed from one of the tables.
</p>
<pre class="wiki">// Tells all attached listeners that the row structure has completely changed in the data source.
// @param[in] table The name of the table to have rows changed in it.
void NotifyRowChange(const EMP::Core::String&amp; table);
</pre><p>
The simpler <i>NotifyRowChange()</i> function informs an attached data grid that one of the tables has completely changed or changed significantly. Use this function when the data set for a table changes entirely, or when many simultaneous individual changes occur that would otherwise cause many of the simpler RowsChanged() calls.
</p>
<h2 id="Specifyingadatagrid">Specifying a data grid</h2>
<p>
Data grids are specified in RML with the &lt;datagrid&gt; tag. The "source" attribute on the data grid specifies which data source object the grid will read from; this is the name of the desired data source and the table name within that data source separated by a dot ('.'). For example, the following data grid will query data from the "player_1" table within the "high_scores" data source:
</p>
<pre class="wiki">&lt;datagrid source="high_scores.player_1" /&gt;
</pre><p>
The data source can be changed in C++ with the <i>SetDataSource()</i> function.
</p>
<pre class="wiki">// Sets a new data source for the contents of the data grid.
// @param[in] data_source_name The name of the new data source.
void SetDataSource(const EMP::Core::String&amp; data_source_name);
</pre><h3 id="Addingcolumns">Adding columns</h3>
<p>
The only children allowed to a data grid element are column definitions, specified with the &lt;col&gt; tag. The column tag takes the following attributes:
</p>
<ul><li><i>fields</i>: A comma-separated list of the fields this column will read from the data grid's data source. This will populate the <i>columns</i> parameter to the GetRow() function.
</li><li><i>formatter</i>: The name of the <a class="wiki" href="../Controls.html#Dataformatters">data formatter</a> used to convert the row data to actual RML. If this is invalid or not provided, then the raw row data is shown, separated by commas.
</li><li><i>width</i>: The initial width of the column, in pixels.
</li></ul><p>
The RML content between the opening and closing column tags will form the header element. Columns can be added in C++ with the <i>AddColumn()</i> function.
</p>
<pre class="wiki">// Adds a column to the table.
// @param[in] fields A comma-separated list of fields that this column reads from the data source.
// @param[in] formatter The name of the data formatter to be used to format the raw column data into RML.
// @param[in] initial_width The initial width, in pixels, of the column.
// @param[in] header_rml The RML to use as the column header.
// @return True if the column was added successfully, false if not.
bool AddColumn(const EMP::Core::String&amp; fields,
               const EMP::Core::String&amp; formatter,
               float initial_width,
               const EMP::Core::String&amp; header_rml);
</pre><h2 id="Dataformatters">Data formatters</h2>
<p>
Data formatters are used to format the raw result of a data source query (an ordered list of strings) into RML content suitable for display inside a data grid cell. A data formatter is a simple object that derives from <i>Rocket::Controls::DataFormatter</i>. The constructor takes a string that acts as the data formatters unique name. It does not need to be registered with anything; as long as it exists it can be queried by data grid columns by its name.
</p>
<p>
A concrete data formatter must implement the <i>FormatData()</i> function:
</p>
<pre class="wiki">// Formats the raw results of a data source request into RML.
// @param[out] formatted_data The formatted RML.
// @param[in] raw_data A list of the raw data fields.
virtual void FormatData(EMP::Core::String&amp; formatted_data,
                        const EMP::Core::StringList&amp; raw_data) = 0;
</pre><p>
See the <a class="wiki" href="../../tutorials/Datagrid.html#Dataformatters">high scores tutorial</a> for examples of creating data formatters.
</p>
<h2 id="Applyingproperties">Applying properties</h2>
<p>
As you would imagine, data grids generate internal elements like they're going out of fashion. Below is a diagram of their internal layout.
</p>
<p>
<img src="../../../../attachment/wiki/documentation/C++Manual/Controls/DataGrid/controls_datagrid_2.gif%3Fformat=raw"/>
</p>
<p>
The data grid element itself, tagged <i>datagrid</i>, has two direct children, <i>datagridheader</i> and <i>datagridbody</i>. The header element contains <i>datagridcolumn</i> elements, one for each column in the data grid. The body element contains all of the data rows, <i>datagridrow</i> elements. Each row contains <i>datagridcell</i> elements, one for each column in the datagrid. Both <i>datagridcell</i> and <i>datagridcolumn</i> elements contain arbitrary RML; in the column's case, the header RML for the column, in the cell's case, the RML generated from the data formatters.
</p>
<p>
Each of these elements can be specified in RCSS rules to easily style the different components of the data grid.
</p>
</div>
</div>
<script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/C%2B%2BManual/Controls/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../../documentation.html">developer.</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
