
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>RCSS - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../TracGuide.html"/><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css"/><link rel="icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="alternate" href="RCSS%3Fformat=txt" title="Plain Text" type="text/x-trac-wiki"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../documentation.html"><img id="title" src="../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/>
<a href="../../documentation.html"><img id="rocket" src="../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/C%2B%2BManual/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual">C++Manual</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual/RCSS">RCSS</a></div>
<div id="title">RCSS</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<div class="wikipage">
<div id="searchable"><p>
<div class="wiki-toc"><h4>Contents</h4><ol><li><a href="RCSS.html#StylesheetsandProperties">Style sheets and Properties</a><ol><li><a href="RCSS.html#Stylesheets">Style sheets</a></li><li>
<a href="RCSS.html#Properties">Properties</a><ol><li><a href="RCSS.html#Queryingproperties">Querying properties</a></li><li>
<a href="RCSS.html#Settingproperties">Setting properties</a></li><li>
<a href="RCSS.html#Definingcustomproperties">Defining custom properties</a></li><li>
<a href="RCSS.html#Definingcustomshorthands">Defining custom shorthands</a></li><li>
<a href="RCSS.html#Definingcustomvalueparsers">Defining custom value parsers</a></li></ol></li></ol></li></ol></div>
</p>
<h1 id="StylesheetsandProperties">Style sheets and Properties</h1>
<p>
A Rocket document may have a number of style sheets attached to it. Each of those style sheets has a list of RCSS properties and rules for selecting which elements those properties are applied to. Any element may also have properties set on them directly.
</p>
<p>
This document only details the C++ interface into the style sheet and property system; for detailed information on what properties are supported and what their function is, see the <a class="wiki" href="../RCSS.html">RCSS documentation</a>.
</p>
<h2 id="Stylesheets">Style sheets</h2>
<p>
Style sheets are automatically loaded and attached to a document when you use the &lt;link type="text/rcss" /&gt; tag in the header of an RML document; this is the most common way style sheets are loaded.
</p>
<p>
If you want to dynamically create or load a style sheet, the Rocket factory (the class Rocket::Core::Factory) has the ability to do this:
</p>
<pre class="wiki">// Creates a style sheet from a user-generated string.
static Rocket::Core::StyleSheet* InstanceStyleSheetString(const EMP::Core::String&amp; string);
// Creates a style sheet from a file.
static Rocket::Core::StyleSheet* InstanceStyleSheetFile(const EMP::Core::String&amp; file_name);
</pre><p>
InstanceStyleSheetString() allows you to parse a string you've built up in your application into a style sheet. This is used in the debugger to keep all of its RML and RCSS content inline. InstanceStyleSheetFile() will load a style sheet from an RCSS file. Both of these functions will return a style sheet pointer on success, which you can then set on a document.
</p>
<p>
Style sheets are reference counted, and a dynamically-loaded style sheet will be returned to you with a single reference count. Remember to remove the reference as appropriate, otherwise the style sheet will never be released.
</p>
<p>
There is currently no way to add rules or properties to a style sheet once it has been loaded.
</p>
<h2 id="Properties">Properties</h2>
<h3 id="Queryingproperties">Querying properties</h3>
<p>
Properties can be requested from an element with the GetProperty() function.
</p>
<pre class="wiki">// Returns one of this element's properties.
const Rocket::Core::Property* GetProperty(const EMP::Core::String&amp; name);		
// Returns the values of one of this element's properties.		
template &lt; typename T &gt;
T Rocket::Core::GetProperty(const EMP::Core::String&amp; name);
</pre><p>
The first, non-templated, GetProperty() function will return the value of request property on the element. If the element does not have the property defined itself, it will either return the default value (if the property is not inherited) or its parent's value (if it is inherited). If the property requested is invalid (ie, not defined in the specification), NULL will be returned.
</p>
<p>
The Rocket::Core::Property structure is defined in &lt;Rocket/Core/Property.h&gt;. Below is a list of its useful members:
</p>
<pre class="wiki">class Rocket::Core::Property
{
public:
	enum Unit
	{
		UNKNOWN,
		KEYWORD,
		STRING,
		NUMBER,
		PX,
		COLOUR,
		EM,
		PERCENT,
	};

	/// Get the property as a string.
	EMP::Core::String ToString() const;

	/// Templatised accessor.
	template &lt;typename T&gt;
	T Get() const
	{
		return value.Get&lt;T&gt;();
	}

	EMP::Core::Variant value;
	Unit unit;
};
</pre><p>
Each property stores the unit its value is in and the value itself as a variant type (EMP::Core::Variant), which is a structure capable of storing a multitude of types. To retrieve the value from the variant, use the templated Get&lt;&gt;() function on the property or the variant itself. The type you should request the value as depends on the property's unit:
</p>
<ul><li>UNKNOWN and STRING values should be requested as EMP::Core::String types.
</li><li>KEYWORD values should be requested as int types. Keyword values are stored as integers for speed; to check what the value means, you can compare it to the constant values defined in &lt;Rocket/Core/StyleSheetKeywords.h&gt;. For custom keyword properties, <a class="wiki" href="RCSS.html">see below</a>.
</li><li>NUMBER, PX, EM and PERCENT values should be requested as float types. The exact meaning of the value depends on the unit.
</li></ul><p>
If you call Get&lt;&gt;() with the wrong type, the variant will do the best it can to convert between the types. For example, if you request a string type on a floating-point value, you will get the stringised form of the value.
</p>
<p>
For example, the following will request the font family of an element:
</p>
<pre class="wiki">element-&gt;GetProperty("font-family")-&gt;Get&lt; EMP::Core::String &gt;();
</pre><p>
The following will check if an element's font weight is bold:
</p>
<pre class="wiki">bool bold = element-&gt;GetProperty("font-weight")-&gt;Get&lt; int &gt;() == Rocket::Core::FONT_WEIGHT_BOLD;
</pre><p>
You can use the templated GetProperty() function to conveniently (and dangerously!) return you the typed value of the requested property. For example:
</p>
<pre class="wiki">bool bold = element-&gt;GetProperty&lt; int &gt;("font-weight") == Rocket::Core::FONT_WEIGHT_BOLD;
</pre><h3 id="Settingproperties">Setting properties</h3>
<p>
Properties can be set directly on an element with the SetProperty() function.
</p>
<pre class="wiki">// Sets a local property override on the element.
bool SetProperty(const EMP::Core::String&amp; name, const EMP::Core::String&amp; value);
</pre><p>
This is equivalent to setting an inline property on an element using the 'style' attribute. For example:
</p>
<pre class="wiki">&lt;div id="test" style="width: 200px;" /&gt;
</pre><p>
is equivalent to:
</p>
<pre class="wiki">Rocket::Core::Element* test = document-&gt;GetElementById("test");
if (test != NULL)
	test-&gt;SetProperty("width", "200px");
</pre><p>
Properties changed in this manner will automatically propagate to child elements if inherited and force a layout if necessary.
</p>
<h3 id="Definingcustomproperties">Defining custom properties</h3>
<p>
User-defined properties can be added to the global style sheet specification, so you can attach any values you'd like to your elements. This is done through the Rocket::Core::StyleSheetSpecification class (included through Rocket/Core.h or Rocket/Core/StyleSheetSpecification.h).
</p>
<pre class="wiki">// Registers a property with a new definition.
// @param[in] property_name The name to register the new property under.
// @param[in] default_value The default value to be used for an element if it has no other definition provided.
// @param[in] inherited True if this property is inherited from parent to child, false otherwise.
// @param[in] forces_layout True if a change in this property on an element will cause the element's layout to possibly change.
// @return The new property definition, ready to have parsers attached.
static Rocket::Core::PropertyDefinition&amp; RegisterProperty(const EMP::Core::String&amp; property_name,
                                                          const EMP::Core::String&amp; default_value,
                                                          bool inherited,
                                                          bool forces_layout = false);
</pre><p>
The RegisterProperty() function takes the name of the new property, the default value of the property (the value of the property on an element if it has not been set on that element), and a boolean value indicating whether the property is inherited. If this is set to true, if an element does not have the property set on it then it will inherit it's parent value for the property instead of using the default value. If the last variable, forces_layout, is set to true, then any change in the property will force the element to be re-laid out. For custom properties this should generally be left as false, as only the built-in properties will affect layout.
</p>
<p>
So, for example, if we wanted to define a new property for storing the sound an element makes when it is clicked, we'd call this soon after the Rocket was initialised:
</p>
<pre class="wiki">Rocket::Core::StyleSheetSpecification::RegisterProperty("click-sound", "none", false);
</pre><p>
This wouldn't be much use to us though, as we haven't said what values the new property can take. For this, we need to add a property parser to the new property. A property parser attempts to parse the value of a property from a raw string into a format where it can be used by the application.
</p>
<p>
Each property can have multiple parsers attached to it. There are four default property parsers in Rocket, although custom parsers <a class="wiki" href="RCSS.html#Definingcustomvalueparsers">can be added</a>. These are:
</p>
<ul><li>'number', for numerical values either with a prefix ('0px', '0.5em'), a percentage ('50%') or simply a number ('15').
</li><li>'keyword', for keyword values (such as the 'font-weight' property, which can be either 'normal' or 'bold').
</li><li>'string', for values that can be set to any string (such as 'font-family').
</li><li>'colour', for values that are stored as a colour.
</li></ul><p>
To attach a parser to a property, call the AddParser() function on the returned value from the RegisterProperty() function. To attach a second or third parser, call AddParser() again on the value returned from the previous call to AddParser(). If multiple parsers are added, values will be run through the parsers in the order that they are specified until one successfully parses the value. Beware of this if you are registering the 'string' parser - make sure you register it last, as it will happily parse any value you give it!
</p>
<p>
So, to add a keyword and a string parser to the previous example, we'd do:
</p>
<pre class="wiki">Rocket::Core::StyleSheetSpecification::RegisterProperty("click-sound", "none", false)
	.AddParser("keyword", "none, beep, boop, bang")
	.AddParser("string");
</pre><p>
Now if the property is set to 'none', 'beep', 'boop' or 'bang', the property's value will be set to the appropriate keyword, otherwise it will be set as a string. So, the following RCSS:
</p>
<pre class="wiki">button
{
	click-sound: beep;
}

button.siren
{
	click-sound: siren.wav;
}
</pre><p>
will set the 'click-sound' property to the keyword 'beep' for all 'button' elements, except if they are of class 'siren', in which case it will be set to the string value 'siren.wav'.
</p>
<p>
Each of the parsers stores their values as a particular unit and type in the property's variant. These are:
</p>
<ul><li>'number' stores values as NUMBER, PX, EM or PERCENTAGE. Use Get&lt; float &gt;() to request the value.
</li><li>'keyword' stores values as KEYWORD. The value is the integer index of the specified keyword in the CSV list of allowed keywords; so, in the previous example, a value of 'none' would be 0, 'beep' would be 1, and so on. Use Get&lt; int &gt;() to request the value.
</li><li>'string' stores values as STRING. Use Get&lt; EMP::Core::String &gt;() to request the value.
</li><li>'colour' stores values as COLOUR. Use Get&lt; EMP::Core::Colourb &gt; to request the value.
</li></ul><h3 id="Definingcustomshorthands">Defining custom shorthands</h3>
<p>
You can define custom shorthands as well as properties. Use the RegisterShorthand() function to do this.
</p>
<pre class="wiki">// Registers a shorthand property definition.
// @param[in] shorthand_name The name to register the new shorthand property under.
// @param[in] properties A comma-separated list of the properties this definition is shorthand for.
// @param[in] type The type of shorthand to declare.
// @param True if all the property names exist, false otherwise.
static bool RegisterShorthand(const EMP::Core::String&amp; shorthand_name,
                              const EMP::Core::String&amp; property_names,
                              Rocket::Core::PropertySpecification::ShorthandType type = Rocket::Core::PropertySpecification::AUTO);
</pre><p>
The first parameter is the name of the shorthand (the name you will use to refer to it in your RCSS). The second is a comma-separated list of the actual properties the shorthand maps to. The third, 'type', is an enumeration defining how the shorthand behaves if it has fewer value given to it than it has properties to assign them to; most of the time you can leave this on 'AUTO', however you can set it to REPLICATE if desired (see below).
</p>
<p>
For example, the 'margin' shorthand is defined like:
</p>
<pre class="wiki">Rocket::Core::StyleSheetSpecification::RegisterShorthand("margin", "margin-top, margin-right, margin-bottom, margin-left");
</pre><p>
Shorthands can operate in three modes; 'FALL_THROUGH', 'REPLICATE' or 'BOX'. FALL_THROUGH will parse each value it has against its list of properties. If any values fail to parse, they will fall-through to the next property, and so on, until they parse successfully. If there are fewer parsed values that properties, the remaining properties will be not be set. The 'font' shorthand is the best example of this; it is a FALL_THROUGH shorthand property for 'font-style', 'font-weight', 'font-size', 'font-family' and 'font-charset'. The RCSS:
</p>
<pre class="wiki">font: italic Lacuna;
</pre><p>
will parse 'font-style' to 'italic'; 'Lacuna' will fail to parse as both a 'font-weight' property and 'font-size', and fall-through to 'font-family'. 'font-charset' will be ignored as the shorthand is out of values.
</p>
<p>
REPLICATE shorthands will fail if any values fail to parse, and if there are fewer values than properties, the last value will be replicated for the other properties. For example, the 'overflow' is a replicating shorthand for the properties 'overflow-x' and 'overflow-y'. The RCSS:
</p>
<pre class="wiki">overflow: auto;
</pre><p>
will assign the 'auto' keyword to both 'overflow-x' and 'overflow-y'. If overflow was a FALL_THROUGH property, 'overflow-y' would be left at its default.
</p>
<p>
BOX shorthands are for shorthands such as 'margin', 'padding', etc, that define four values for the top, right, bottom and left sides (in that order) of a box. If a BOX shorthand is invoked with fewer than four values, the standard CSS rules apply; that is, one value will be replicated across all four sides. Two values will be set to the vertical and horizontal sides. Three values will be set to the top, horizontal sides, and bottom.
</p>
<p>
AUTO shorthands will be FALL_THROUGH by default, unless they have exactly four properties ending in '-top', '-right', '-bottom' and '-left' (in that order).
</p>
<h3 id="Definingcustomvalueparsers">Defining custom value parsers</h3>
<p>
If you want to define more complicated parsers for your property values, you can do so by registering a custom property parser before you register you custom properties. The base class for all property parsers is Rocket::Core::PropertyParser; start by inheriting from this and implementing the two pure virtual functions:
</p>
<pre class="wiki">// Called to parse a RCSS declaration.
// @param[out] property The property to set the parsed value on.
// @param[in] value The raw value defined for this property.
// @param[in] parameters The list of parameters defined for this property.
// @return True if the value was parsed successfully, false otherwise.
virtual bool ParseValue(Rocket::Core::Property&amp; property,
                        const EMP::Core::String&amp; value,
                        const Rocket::Core::ParameterMap&amp; parameters) const = 0;

// Called when the parser is released. This should free all dynamic memory used by the parser.
virtual void Release() = 0;
</pre><p>
ParseValue() is the meat of the parser. This will be called whenever the parser is required to parse a raw string value into a useful value. The 'property' parameter is the property the parsed value and unit should be written to. The 'value' parameter is the raw string (ie, '15px'). 'parameters' is the map of the CSV parameters given to the parser when the property was declared. For example, if a custom parser was attached to a property in the following manner:
</p>
<pre class="wiki">Rocket::Core::StyleSheetSpecification::RegisterProperty("custom-property", "parameter-1", false)
	.AddParser("custom-parser", "parameter-1, parameter-2")
</pre><p>
the 'parameters' map would contain the values 'parameter-1' and 'parameter-2'. The value of each of these is the index of the value in the CSV list; so, 'parameter-1' resolves to 0, 'parameter-2' resolves to 1.
</p>
<p>
If the value cannot be parsed, the unit of the property should be set to Rocket::Core::Property::UNKNOWN. If it can be parsed, the unit should be set to something other than UNKNOWN and the value set on the property's variant appropriately.
</p>
<p>
The Release() function is called when Rocket is shut down; the parser should take this opportunity to delete itself if it was dynamically allocated.
</p>
<p>
Once you've got a working custom parser, call RegisterParser() on StyleSheetSpecification to register your parser against a parser name. Parser names are resolved immediately when properties are registered, so you'll need to register your parsers before you register your properties.
</p>
</div>
</div>
<script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/C%2B%2BManual/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
