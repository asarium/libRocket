
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title> Contexts - libRocket</title>
<link rel="start" href="http://librocket.com/wiki"/><link rel="search" href="http://librocket.com/search"/><link rel="help" href="../../TracGuide.html"/><link rel="stylesheet" href="../../../chrome/common/css/trac.css" type="text/css"/><link rel="stylesheet" href="../../../chrome/common/css/wiki.css" type="text/css"/><link rel="icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="shortcut icon" href="../../../chrome/site/trac.ico" type="image/x-icon"/><link rel="alternate" href="Contexts%3Fversion=2&amp;format=txt" title="Plain Text" type="text/x-trac-wiki"/><style type="text/css">
</style>
<script type="text/javascript" src="../../../chrome/common/js/trac.js"></script>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/base.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/content.css"></link>
<link rel="stylesheet" type="text/css" href="../../../chrome/site/style/discussion.css"></link>
<style>
		div.wiki img
		{
			display: block;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
<div class="widthshell-width">
<div class="widthshell-minwidth">
<div class="widthshell-layout">
<div class="widthshell-container">
<div class="widthshell-content">
<div id="background">
<div style="float:right;width:160px;height:600px;margin-top:110px;margin-right:20px;">
<script type="text/javascript"><!--
                        google_ad_client = "pub-5872045433470541";
                        /* Default, Wide Skyscraper */
                        google_ad_slot = "3956485030";
                        google_ad_width = 160;
                        google_ad_height = 600;
                //-->
                </script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>
</div>
<div class="shell">
<div class="stars">
<img id="star-1" src="../../../chrome/site/images/star-red-medium.gif" width="22px" height="22px" alt="Star"/>
<img id="star-2" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-3" src="../../../chrome/site/images/star-red-small.gif" width="11px" height="11px" alt="Star"/>
<img id="star-4" src="../../../chrome/site/images/star-orange-small.gif" width="16px" height="16px" alt="Star"/>
<img id="star-5" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-6" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-7" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-8" src="../../../chrome/site/images/star-red-big.gif" width="33px" height="33px" alt="Star"/>
<img id="star-9" src="../../../chrome/site/images/star-red-small.gif" width="13px" height="13px" alt="Star"/>
<img id="star-10" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
<img id="star-11" src="../../../chrome/site/images/star-red-tiny.gif" width="8px" height="7px" alt="Star"/>
<img id="star-12" src="../../../chrome/site/images/star-red-tiny.gif" width="7px" height="6px" alt="Star"/>
</div>
<div id="header">
<a href="../../documentation.html"><img id="title" src="../../../chrome/site/images/title.gif" width="256px" height="49px" alt="Rocket"/></a>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>

<li><a href="http://github.com/lloydw/librocket">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
<img id="trail" src="../../../chrome/site/images/trail-content.gif" width="72px" height="115px" alt="Rocket Trail"/>
<a href="../../documentation.html"><img id="rocket" src="../../../chrome/site/images/rocket-content.gif" width="126px" height="139px" alt="Rocket"/></a>
</div>
</div>
</div>
<div class="shell">
<div id="banner">
<div class="stars">
<img id="star-13" src="../../../chrome/site/images/star-black-big.gif" width="49px" height="50px" alt="Star"/>
<img id="star-14" src="../../../chrome/site/images/star-black-medium.gif" width="23px" height="23px" alt="Star"/>
<img id="star-15" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-16" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-17" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-18" src="../../../chrome/site/images/star-black-tiny.gif" width="13px" height="13px" alt="Star"/>
<img id="star-19" src="../../../chrome/site/images/star-black-tiny.gif" width="9px" height="9px" alt="Star"/>
<img id="star-20" src="../../../chrome/site/images/star-black-tiny.gif" width="10px" height="10px" alt="Star"/>
<img id="star-21" src="../../../chrome/site/images/star-black-medium.gif" width="21px" height="21px" alt="Star"/>
<img id="star-22" src="../../../chrome/site/images/star-black-small.gif" width="14px" height="14px" alt="Star"/>
<img id="star-23" src="../../../chrome/site/images/star-black-small.gif" width="13px" height="13px" alt="Star"/>
</div>
<img id="banner-bottom-left" src="../../../chrome/site/images/banner-bottom-left.gif" width="20px" height="19px" alt="Bottom left banner image"/>
<img id="banner-bottom-right" src="../../../chrome/site/images/banner-bottom-right.gif" width="20px" height="19px" alt="Bottom right banner image"/>
<div id="login"><a href="http://librocket.com/login">Login</a> | <a "http://librocket.com/wiki/documentation/C%2B%2BManual/href">Register</a></div>
<div id="breadcrumbs">
<a href="../../documentation.html">documentation</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual">C++Manual</a> <strong>&#8249;</strong> <a href="http://librocket.com/wiki/documentation/C++Manual/Contexts">Contexts</a></div>
<div id="title"> Contexts</div>
<div id="second-level-nav">
<span class="nav-item active"><a href="../../documentation.html">Documentation</a></span>
<span class="nav-item"><a accesskey="4" href="http://librocket.com/search">Search</a></span>
</div>
</div>
<div id="content-container">
<div id="content" class="wiki">
<table id="info" summary="Revision info"><tbody><tr>
<th scope="col">
Version 2 (modified by lloydw, 9 years ago)
</th></tr><tr>
<td class="message">--</td>
</tr>
</tbody></table>
<div class="wikipage">
<div id="searchable"><p>
<div class="wiki-toc"><h4>Contents</h4><ol><li><a href="Contexts%3Fversion=2.html#Contexts">Contexts</a><ol><li><a href="Contexts%3Fversion=2.html#Usesofmultiplecontexts">Uses of multiple contexts</a><ol><li><a href="Contexts%3Fversion=2.html#Multipledesktops">Multiple desktops</a></li><li>
<a href="Contexts%3Fversion=2.html#In-worldinterfaces">In-world interfaces</a></li></ol><li><a href="Contexts%3Fversion=2.html#Creatingacontext">Creating a context</a></li><li>
<a href="Contexts%3Fversion=2.html#Releasingacontext">Releasing a context</a></li><li>
<a href="Contexts%3Fversion=2.html#Updateandrendering">Update and rendering</a></li><li>
<a href="Contexts%3Fversion=2.html#Loadingandcreatingdocuments">Loading and creating documents</a></li><li>
<a href="Contexts%3Fversion=2.html#Cursors">Cursors</a><ol><li><a href="Contexts%3Fversion=2.html#Loadingcursors">Loading cursors</a></li><li>
<a href="Contexts%3Fversion=2.html#Sharingcursors">Sharing cursors</a></li></ol><li><a href="Contexts%3Fversion=2.html#Events">Events</a></li><li>
<a href="Contexts%3Fversion=2.html#Input">Input</a></li><li>
<a href="Contexts%3Fversion=2.html#Customcontexts">Custom contexts</a><ol><li><a href="Contexts%3Fversion=2.html#Creatingacustomcontext">Creating a custom context</a></li><li>
<a href="Contexts%3Fversion=2.html#Creatingacustomcontextinstancer">Creating a custom context instancer</a></li><li>
<a href="Contexts%3Fversion=2.html#Registeringaninstancer">Registering an instancer</a></li><li>
<a href="Contexts%3Fversion=2.html#EnumeratingContexts">Enumerating Contexts</a></li></ol></li></ol></li></ol></div>
</p>
<h1 id="Contexts">Contexts</h1>
<p>
Rocket contexts are independent collections of documents. All documents exist within a single context. Contexts are rendered, updated and given input independently of each other at the application's discretion.
</p>
<h2 id="Usesofmultiplecontexts">Uses of multiple contexts</h2>
<p>
Most games will feature a single context for the main interface. Multiple contexts could be used however for a number of different reasons.
</p>
<h3 id="Multipledesktops">Multiple desktops</h3>
<p>
A second or subsequent context could be used to store alternative 'desktops' that the user could switch to, in a similar fashion to many Linux desktops. This could be very useful for interface-heavy games where the user may have several windows open at once, more than could fit easily onto one screen.
</p>
<h3 id="In-worldinterfaces">In-world interfaces</h3>
<p>
Computer terminals or consoles in a 3D game world could themselves be Rocket contexts. As they wouldn't necessarily be viewed parallel to the screen, mouse input would need to be projected onto the surface. When the context was rendered, it would need to be transformed correctly to fit onto the surface or rendered onto a texture.
</p>
<h2 id="Creatingacontext">Creating a context</h2>
<p>
To create a new context, use the CreateContext() function in Rocket::Core.
</p>
<pre class="wiki">// Creates a new element context.
// @param[in] name The new name of the context. This must be unique.
// @param[in] dimensions The initial dimensions of the new context.
// @return The new context, or NULL if the context could not be created.
Rocket::Core::Context* CreateContext(const EMP::Core::String&amp; name,
                                     const EMP::Core::Vector2i&amp; dimensions);
</pre><p>
The context needs a unique string name and initial dimensions. The dimensions are used to generate relative lengths (for example, if a document has a percentage dimension), and sets the extents for the mouse cursor within the context.
</p>
<p>
To fetch a previously-constructed context, use the GetContext() function.
</p>
<pre class="wiki">// Fetches a previously constructed context by name.
// @param[in] name The name of the desired context.
// @return The desired context, or NULL if no context exists with the given name.
Rocket::Core::Context* GetContext(const EMP::Core::String&amp; name);
</pre><h2 id="Releasingacontext">Releasing a context</h2>
<p>
Contexts are reference counted, and begin with a reference count of one. Once you have finished with a context, call RemoveReference() to release it. It will be destroyed, and all of its documents released.
</p>
<h2 id="Updateandrendering">Update and rendering</h2>
<p>
If a context is active, it should have Update() called on it after the frame's input events have been sent to it.
</p>
<pre class="wiki">// Updates all elements in the context's documents.
bool Update();
</pre><p>
To render a context, call Render() on it. Easy!
</p>
<pre class="wiki">// Renders all visible elements in the context's documents.
bool Render();
</pre><h2 id="Loadingandcreatingdocuments">Loading and creating documents</h2>
<p>
Documents are loaded through contexts. To load a document from an RML file into a context, call the LoadDocument() function on the appropriate context.
</p>
<pre class="wiki">// Load a document into the context.
// @param[in] document_path The path to the document to load.
// @return The loaded document, or NULL if no document was loaded.
ElementDocument* LoadDocument(const EMP::Core::String&amp; document_path);
</pre><p>
The document_path parameter will be given to Rocket's <a class="missing wiki" href="http://librocket.com/wiki/documention/C%2B%2BManual/Interfaces#Thefileinterface" rel="nofollow">file interface?</a> to be open and read. If the document is loaded successfully, it will be added to the context and returned. Call Show() on the document to make it visible.
</p>
<p>
You can also load documents directly from a memory stream, this can be useful if you want to receive documents over the network or similar.
</p>
<pre class="wiki">// Load a document into the context.
// @param[in] string The string containing the document RML.
// @return The loaded document, or NULL if no document was loaded.
ElementDocument* LoadDocumentFromMemory(const EMP::Core::String&amp; string);
</pre><p>
To create a new, empty document you can populate dynamically, use the CreateDocument() function.
</p>
<pre class="wiki">// Creates a new, empty document and places it into this context.
// @param[in] tag The document type to create.
// @return The new document, or NULL if no document could be created.
ElementDocument* CreateDocument(const EMP::Core::String&amp; tag = "document");
</pre><p>
The context will attempt to instance an element using the 'body' instancer, with the tag name specified by the caller. If a Rocket::Core::ElementDocument is instanced, it will be added to the context and returned.
</p>
<h2 id="Cursors">Cursors</h2>
<p>
Each context maintains a list of cursors that can be used to represent the mouse cursor. Regardless of the number of cursors loaded into a context, only one cursor is rendered at a time. The default cursor is the first element to be loaded; this will be the visible cursor unless an element overrides it through the <a class="wiki" href="../RCSS/UserInterface.html#Cursors:thecursorproperty">'cursor' property</a>.
</p>
<h3 id="Loadingcursors">Loading cursors</h3>
<p>
Mouse cursors can be loaded into a context using the LoadMouseCursor() function.
</p>
<pre class="wiki">// Loads a document as a mouse cursor within this context.
// @param[in] cursor_document_path The path to the document to load as a cursor.
// @return The loaded cursor document, or NULL if no document was loaded.
Rocket::Core::ElementDocument* LoadMouseCursor(const EMP::Core::String&amp; cursor_document_path);
</pre><p>
Cursors are documents themselves, and are loaded the same way internally. Any valid RML document can be loaded as a document; of course, you're most likely to want a simple document with an image decorator, but you're not limited to this!
</p>
<p>
Note that the cursor's 'name' is the title of its document. This is the name you'll use to specify it through the 'cursor' property.
</p>
<h3 id="Sharingcursors">Sharing cursors</h3>
<p>
Mouse cursors can also be shared across contexts with the AddMouseCursor() function.
</p>
<pre class="wiki">// Adds a previously-loaded cursor document as a mouse cursor within this context.
// @param[in] cursor_document The document to add as a cursor into this context.
void AddMouseCursor(Rocket::Core::ElementDocument* cursor_document);
</pre><p>
Call AddMouseCursor() with a cursor loaded into another context.
</p>
<h2 id="Events">Events</h2>
<p>
Event listeners can be attached to a context (rather than an element) to receive events sent to all elements within that context. As with elements, call AddEventListener() to attach a listener and RemoveEventListener() to detach.
</p>
<pre class="wiki">// Adds an event listener to the context's root element.
// @param[in] event The name of the event to attach to.
// @param[in] listener Listener object to be attached.
// @param[in] in_capture_phase True if the listener is to be attached to the capture phase, false for the bubble phase.
void AddEventListener(const EMP::Core::String&amp; event,
                      Rocket::Core::EventListener* listener,
                      bool in_capture_phase = false);

// Removes an event listener from the context's root element.
// @param[in] event The name of the event to detach from.
// @param[in] listener Listener object to be detached.
// @param[in] in_capture_phase True to detach from the capture phase, false from the bubble phase.
void RemoveEventListener(const EMP::Core::String&amp; event,
                         Rocket::Core::EventListener* listener,
                         bool in_capture_phase = false);
</pre><h2 id="Input">Input</h2>
<p>
See the section on <a class="wiki" href="Input.html">input</a> for detail on sending user input from your application into Rocket contexts.
</p>
<h2 id="Customcontexts">Custom contexts</h2>
<p>
Contexts are created, like elements and decorators, through instancers. You can override the default context instancer if you want to create custom contexts. Generally, this is only required for adding support for scripting languages.
</p>
<h3 id="Creatingacustomcontext">Creating a custom context</h3>
<p>
A custom context is a class derived from Rocket::Core::Context. There are no virtual methods on Rocket::Core::Context, so it cannot be specialised.
</p>
<h3 id="Creatingacustomcontextinstancer">Creating a custom context instancer</h3>
<p>
A custom context instancer needs to be registered with the Rocket factory in order to override the default instancer. A custom context instancer needs to be derived from Rocket::Core::ContextInstancer, and implement the required virtual methods:
</p>
<pre class="wiki">// Instances a context.
// @param[in] name Name of this context.
// @return The instanced context.
virtual Rocket::Core::Context* InstanceContext(const EMP::Core::String&amp; name) = 0;

// Releases a context previously created by this context.
// @param[in] context The context to release.
virtual void ReleaseContext(Rocket::Core::Context* context) = 0;

// Releases this context instancer
virtual void Release() = 0;
</pre><p>
InstanceContext() will be called whenever a new context is requested. It takes a single parameter, <i>name</i>, the name of the new context. If a context can be created, it should be initialised and returned. Otherwise, return NULL (0).
</p>
<p>
ReleaseContext() will be called whenever a context is released. The context instancer should destroy the context and free and resources allocated for it.
</p>
<p>
Release() will be called when Rocket is shut down. The instancer should delete itself if it was dynamically allocated.
</p>
<h3 id="Registeringaninstancer">Registering an instancer</h3>
<p>
To register a custom instancer with Rocket, call RegisterContextInstancer() on the Rocket factory after Rocket has been initialised.
</p>
<pre class="wiki">Rocket::Core::ContextInstancer* custom_instancer = new CustomContextInstancer();
Rocket::Core::Factory::RegisterContextInstancer(custom_instancer);
custom_instancer-&gt;RemoveReference();
</pre><p>
Like other instancers, context instancers are reference counted and begin with a single reference. The factory will add its own reference to the instancer once it is registered, so you must remove the initial reference afterwards.
</p>
</div>
</div>
<script type="text/javascript">
   addHeadingLinks(document.getElementById("searchable"), "Link to this section");
  </script>
</div>
</div>
</div>
<div id="footer">
<a id="tracpowered" href="http://trac.edgewall.org/">
<img src="../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered"/>
</a>
<p class="left">
Powered by <a href="http://librocket.com/about"><strong>Trac </strong></a><br/>By <a href="http://www.edgewall.org/">Edgewall Software</a>.
</p>
<p id="copyright" class="left clear">
Copyright &copy; 2007-2010 Code Point Ltd, Shift Technology Ltd.
</p>
<ul class="top-level-nav">
<li><a href="../../frontend/features.html">features.</a></li>
<li><a "http://librocket.com/wiki/documentation/C%2B%2BManual/href">download.</a></li>
<li><a href="http://forums.librocket.com">forums.</a></li>
<li><a href="../../documentation.html">developer.</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
<script type="text/javascript">
    var pageTracker = _gat._getTracker("UA-3379591-1");
    pageTracker._initData();
    pageTracker._trackPageview();
    </script>
</body>
</html>
